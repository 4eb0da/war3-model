import{T as _,M as j,G as Bn,P as X,b as R,C as K,c as U,L as B,d as w,N as S,e as $,f as v,g as L,F as C,h as P}from"./shim-C4SHjc5J.js";/*!
    war3-model v4.0.0
	https://github.com/4eb0da/war3-model
	Released under the MIT License.
*/const Dn=6,D=1e-6;function On(n,e=0){return Math.abs(n[0]-e)>D||Math.abs(n[1]-e)>D||Math.abs(n[2]-e)>D}function g(n=1){if(n===0)return"";let e="	";for(let t=1;t<n;++t)e+="	";return e}function Z(n){return`"${n}"`}function Kn(n){return typeof n=="number"?String(n):Z(n)}function l(n,e=null,t=0){return g(t)+n+" "+(e!==null?Kn(e)+" ":"")+`{
`}function a(n=0){return g(n)+`}
`}const Hn=/(\..+?)0+$/,jn=/\.0+$/,Un=/^-0$/;function F(n){return n.toFixed(Dn).replace(Hn,"$1").replace(jn,"").replace(Un,"0")}function A(n,e=!1){let t="";if(e)for(let i=n.length-1;i>=0;--i)i<n.length-1&&(t+=", "),t+=F(n[i]);else for(let i=0;i<n.length;++i)i>0&&(t+=", "),t+=F(n[i]);return"{ "+t+" }"}function W(n){let e="";for(let t=0;t<n.length;++t)t>0&&(e+=", "),e+=String(n[t]);return"{ "+e+" }"}function $n(n){return n?"static ":""}function x(n,e,t,i=1){return`${g(i)+$n(t)+n} ${e},
`}function h(n,e,t=null,i=1){return x(n,String(e),t,i)}function k(n,e,t=null,i=1){return x(n,F(e),t,i)}function q(n,e,t=null,i=1){return x(n,e,t,i)}function E(n,e,t=null,i=1){return x(n,Z(e),t,i)}function y(n,e,t=null,i=1){return x(n,A(e),t,i)}function Y(n,e,t=null,i=1){return x(n,W(e),t,i)}function f(n,e=1){return g(e)+n+`,
`}function s(n,e,t=0,i=null,u=1){return e!==t&&e!==null&&e!==void 0?h(n,e,i,u):""}function M(n,e,t=0,i=null,u=1){return Math.abs(e-t)>D?k(n,e,i,u):""}function qn(n){switch(n){case P.DontInterp:return"DontInterp";case P.Linear:return"Linear";case P.Bezier:return"Bezier";case P.Hermite:return"Hermite"}return""}function Wn(n,e=2,t=!1){let i=g(e)+n.Frame+": "+(n.Vector.length===1?F(n.Vector[0]):A(n.Vector,t))+`,
`;return n.InTan&&(i+=g(e+1)+"InTan "+(n.InTan.length===1?F(n.InTan[0]):A(n.InTan,t))+`,
`,i+=g(e+1)+"OutTan "+(n.OutTan.length===1?F(n.OutTan[0]):A(n.OutTan,t))+`,
`),i}function r(n,e,t=0,i=1,u=!1){return e==null?"":typeof e=="number"?typeof t=="number"&&Math.abs(e-t)<D?"":k(n,e,!0,i):l(n,e.Keys.length,i)+f(qn(e.LineType),i+1)+(e.GlobalSeqId!==null?h("GlobalSeqId",e.GlobalSeqId,null,i+1):"")+e.Keys.map(c=>Wn(c,i+1,u)).join("")+a(i)}function _n(n){return l("Version")+h("FormatVersion",n.Version)+a()}function Xn(n){return l("Model",n.Info.Name)+s("NumGeosets",n.Geosets.length)+s("NumGeosetAnims",n.GeosetAnims.length)+s("NumHelpers",n.Helpers.length)+s("NumBones",n.Bones.length)+(n.Lights.length?s("NumLights",n.Lights.length):"")+s("NumAttachments",n.Attachments.length)+s("NumEvents",n.EventObjects.length)+s("NumParticleEmitters",n.ParticleEmitters.length)+(n.ParticleEmitters2.length?s("NumParticleEmitters2",n.ParticleEmitters2.length):"")+(n.RibbonEmitters.length?s("NumRibbonEmitters",n.RibbonEmitters.length):"")+h("BlendTime",n.Info.BlendTime)+y("MinimumExtent",n.Info.MinimumExtent)+y("MaximumExtent",n.Info.MaximumExtent)+M("BoundsRadius",n.Info.BoundsRadius)+a()}function Zn(n){return l("Sequences",n.Sequences.length)+n.Sequences.map(Yn).join("")+a()}function Yn(n){return l("Anim",n.Name,1)+Y("Interval",n.Interval,null,2)+M("Rarity",n.Rarity,0,null,2)+M("MoveSpeed",n.MoveSpeed,0,null,2)+(n.NonLooping?f("NonLooping",2):"")+y("MinimumExtent",n.MinimumExtent,null,2)+y("MaximumExtent",n.MaximumExtent,null,2)+M("BoundsRadius",n.BoundsRadius,0,null,2)+a(1)}function Qn(n){return!n.GlobalSequences||!n.GlobalSequences.length?"":l("GlobalSequences",n.GlobalSequences.length)+n.GlobalSequences.map(e=>h("Duration",e)).join("")+a()}function Jn(n){return n.Textures.length?l("Textures",n.Textures.length)+n.Textures.map(zn).join("")+a():""}function zn(n){return l("Bitmap",null,1)+E("Image",n.Image,null,2)+s("ReplaceableId",n.ReplaceableId,0,null,2)+(n.Flags&_.WrapWidth?f("WrapWidth",2):"")+(n.Flags&_.WrapHeight?f("WrapHeight",2):"")+a(1)}function mn(n){return n.Materials.length?l("Materials",n.Materials.length)+n.Materials.map(e=>ne(n,e)).join("")+a():""}function ne(n,e){let t="";return n.Version>=900&&n.Version<1100&&e.Shader&&(t=E("Shader",e.Shader,!1,2)),l("Material",null,1)+(e.RenderMode&j.ConstantColor?f("ConstantColor",2):"")+(e.RenderMode&j.SortPrimsFarZ?f("SortPrimsFarZ",2):"")+(e.RenderMode&j.FullResolution?f("FullResolution",2):"")+s("PriorityPlane",e.PriorityPlane,0,null,2)+s("RenderMode",e.RenderMode,0,null,2)+t+e.Layers.map(i=>te(n,i)).join("")+a(1)}function ee(n){switch(n){case C.None:return"None";case C.Transparent:return"Transparent";case C.Blend:return"Blend";case C.Additive:return"Additive";case C.AddAlpha:return"AddAlpha";case C.Modulate:return"Modulate";case C.Modulate2x:return"Modulate2x"}return""}function te(n,e){let t="";return n.Version>=900&&(t+=e.EmissiveGain!==void 0?r("EmissiveGain",e.EmissiveGain,1,3):"",n.Version>=1e3&&(t+=e.FresnelColor!==void 0?I("FresnelColor",e.FresnelColor,!0,3):"",t+=e.FresnelOpacity!==void 0?r("FresnelOpacity",e.FresnelOpacity,0,3):"",t+=e.FresnelTeamColor!==void 0?r("FresnelTeamColor",e.FresnelTeamColor,0,3):"")),n.Version>=1100&&(t+=h("ShaderTypeId",e.ShaderTypeId||0,null,3),B.slice(1).forEach(i=>{const u=e[i];u!==void 0&&(t+=r(i,u,null,3))})),l("Layer",null,2)+q("FilterMode",ee(e.FilterMode),null,3)+(e.Alpha!==void 0?r("Alpha",e.Alpha,1,3):"")+(e.TextureID!==void 0?r("TextureID",e.TextureID,null,3):"")+(e.Shading&w.TwoSided?f("TwoSided",3):"")+(e.Shading&w.Unshaded?f("Unshaded",3):"")+(e.Shading&w.Unfogged?f("Unfogged",3):"")+(e.Shading&w.SphereEnvMap?f("SphereEnvMap",3):"")+(e.Shading&w.NoDepthTest?f("NoDepthTest",3):"")+(e.Shading&w.NoDepthSet?f("NoDepthSet",3):"")+s("CoordId",e.CoordId,0,null,3)+s("TVertexAnimId",e.TVertexAnimId,null,null,3)+t+a(2)}function ie(n){return n.TextureAnims.length?l("TextureAnims",n.TextureAnims.length)+n.TextureAnims.map(oe).join("")+a():""}function oe(n){return l("TVertexAnim",null,1)+(n.Translation?r("Translation",n.Translation,null,2):"")+(n.Rotation?r("Rotation",n.Rotation,null,2):"")+(n.Scaling?r("Scaling",n.Scaling,null,2):"")+a(1)}function re(n){return n.Geosets.length?n.Geosets.map(e=>ue(n,e)).join(""):""}function ue(n,e){let t="";return n.Version>=900&&(t+=(e.LevelOfDetail!==void 0?h("LevelOfDetail",e.LevelOfDetail):"")+(e.Name?E("Name",e.Name):"")+(e.Tangents?N("Tangents",e.Tangents,4):"")+(e.SkinWeights?N("SkinWeights",e.SkinWeights,8):"")),l("Geoset")+N("Vertices",e.Vertices,3)+N("Normals",e.Normals,3)+N("TVertices",e.TVertices[0],2)+le(e.VertexGroup)+ae(e.Faces)+fe(e.Groups)+y("MinimumExtent",e.MinimumExtent)+y("MaximumExtent",e.MaximumExtent)+M("BoundsRadius",e.BoundsRadius)+se(e.Anims)+h("MaterialID",e.MaterialID)+h("SelectionGroup",e.SelectionGroup)+(e.Unselectable?f("Unselectable"):"")+t+a()}function N(n,e,t){let i="";const u=e.length/t;for(let c=0;c<u;++c)i+=g(2)+A(e.slice(c*t,(c+1)*t))+`,
`;return l(n,u,1)+i+a(1)}function le(n){if(!n.length)return"";let e="";for(let t=0;t<n.length;++t)e+=g(2)+n[t]+`,
`;return l("VertexGroup",null,1)+e+a(1)}function ae(n){return l(`Faces 1 ${n.length}`,null,1)+l("Triangles",null,2)+g(3)+W(n)+`,
`+a(2)+a(1)}function fe(n){let e=0,t="";for(const i of n)e+=i.length,t+=g(2)+"Matrices "+W(i)+`,
`;return l(`Groups ${n.length} ${e}`,null,1)+t+a(1)}function se(n){return n?n.map(ce).join(""):""}function ce(n){return l("Anim",null,1)+y("MinimumExtent",n.MinimumExtent,null,2)+y("MaximumExtent",n.MaximumExtent,null,2)+M("BoundsRadius",n.BoundsRadius,0,null,2)+a(1)}function he(n){return n.GeosetAnims.length?n.GeosetAnims.map(ge).join(""):""}function I(n,e,t,i=1){if(e)if(e instanceof Float32Array){if(!t||On(e,1)){let u="";for(let c=2;c>=0;--c)c<2&&(u+=", "),u+=F(e[c]);return`${g(i)}${t?"static ":""}${n} { ${u} },
`}}else return r(n,e,null,i,!0);return""}function ge(n){return l("GeosetAnim")+h("GeosetId",n.GeosetId)+r("Alpha",n.Alpha,1)+I("Color",n.Color,!0)+(n.Flags&Bn.DropShadow?f("DropShadow"):"")+a()}function d(n){return h("ObjectId",n.ObjectId)+s("Parent",n.Parent,null)+pe(n.Flags)+(n.Flags&S.Billboarded?f("Billboarded"):"")+(n.Flags&S.BillboardedLockX?f("BillboardedLockX"):"")+(n.Flags&S.BillboardedLockY?f("BillboardedLockY"):"")+(n.Flags&S.BillboardedLockZ?f("BillboardedLockZ"):"")+(n.Flags&S.CameraAnchored?f("CameraAnchored"):"")+(n.Translation!==void 0?r("Translation",n.Translation):"")+(n.Rotation!==void 0?r("Rotation",n.Rotation):"")+(n.Scaling!==void 0?r("Scaling",n.Scaling):"")}function pe(n){const e=[];return n&S.DontInheritTranslation&&e.push("Translation"),n&S.DontInheritRotation&&e.push("Rotation"),n&S.DontInheritScaling&&e.push("Scaling"),e.length?g(1)+"DontInherit { "+e.join(", ")+` },
`:""}function ye(n){return n.Bones.length?n.Bones.map(be).join(""):""}function be(n){return l("Bone",n.Name)+d(n)+(n.GeosetId!==null?h("GeosetId",n.GeosetId):q("GeosetId","Multiple"))+(n.GeosetAnimId!==null?h("GeosetAnimId",n.GeosetAnimId):q("GeosetAnimId","None"))+a()}function Ae(n){return n.Lights.length?n.Lights.map(de).join(""):""}function de(n){return l("Light",n.Name)+d(n)+f(Te(n.LightType))+r("AttenuationStart",n.AttenuationStart)+r("AttenuationEnd",n.AttenuationEnd)+I("Color",n.Color,!0)+r("Intensity",n.Intensity,null)+I("AmbColor",n.AmbColor,!0)+r("AmbIntensity",n.AmbIntensity,null)+r("Visibility",n.Visibility,1)+a()}function Te(n){switch(n){case $.Omnidirectional:return"Omnidirectional";case $.Directional:return"Directional";case $.Ambient:return"Ambient"}return""}function Ve(n){return n.Helpers.map(Se).join("")}function Se(n){return l("Helper",n.Name)+d(n)+a()}function Le(n){return n.Attachments.map(Pe).join("")}function Pe(n){return l("Attachment",n.Name)+d(n)+h("AttachmentID",n.AttachmentID)+(n.Path?E("Path",n.Path):"")+r("Visibility",n.Visibility,1)+a()}function Ee(n){return l("PivotPoints",n.PivotPoints.length)+n.PivotPoints.map(e=>`${g()}${A(e)},
`).join("")+a()}function Ce(n){return n.ParticleEmitters.map(Fe).join("")}function Fe(n){return l("ParticleEmitter",n.Name)+d(n)+(n.Flags&X.EmitterUsesMDL?f("EmitterUsesMDL"):"")+(n.Flags&X.EmitterUsesTGA?f("EmitterUsesTGA"):"")+r("EmissionRate",n.EmissionRate)+r("Gravity",n.Gravity)+r("Longitude",n.Longitude)+r("Latitude",n.Latitude)+r("Visibility",n.Visibility)+l("Particle",null,1)+r("LifeSpan",n.LifeSpan,null,2)+r("InitVelocity",n.InitVelocity,null,2)+E("Path",n.Path,!1,2)+a(1)+a()}function Ie(n){return n.ParticleEmitters2.map(ke).join("")}function Ge(n){switch(n){case v.Blend:return"Blend";case v.Additive:return"Additive";case v.Modulate:return"Modulate";case v.Modulate2x:return"Modulate2x";case v.AlphaKey:return"AlphaKey"}return""}function Re(n){return l("SegmentColor",null,1)+n.map(e=>I("Color",e,!1,2)).join("")+g()+`},
`}function we(n){return n&L.Head&&n&L.Tail?"Both":n&L.Head?"Head":n&L.Tail?"Tail":""}function ke(n){return l("ParticleEmitter2",n.Name)+d(n)+f(Ge(n.FilterMode))+r("Speed",n.Speed,null)+r("Variation",n.Variation,null)+r("Latitude",n.Latitude,null)+r("Gravity",n.Gravity,null)+r("EmissionRate",n.EmissionRate,null)+r("Width",n.Width,null)+r("Length",n.Length,null)+r("Visibility",n.Visibility,1)+Re(n.SegmentColor)+Y("Alpha",n.Alpha)+y("ParticleScaling",n.ParticleScaling)+y("LifeSpanUVAnim",n.LifeSpanUVAnim)+y("DecayUVAnim",n.DecayUVAnim)+y("TailUVAnim",n.TailUVAnim)+y("TailDecayUVAnim",n.TailDecayUVAnim)+s("Rows",n.Rows,0)+s("Columns",n.Columns,0)+h("TextureID",n.TextureID)+s("Time",n.Time,0)+s("LifeSpan",n.LifeSpan,0)+s("TailLength",n.TailLength,0)+s("PriorityPlane",n.PriorityPlane,0)+s("ReplaceableId",n.ReplaceableId,null)+(n.Flags&R.SortPrimsFarZ?f("SortPrimsFarZ"):"")+(n.Flags&R.LineEmitter?f("LineEmitter"):"")+(n.Flags&R.ModelSpace?f("ModelSpace"):"")+(n.Flags&R.Unshaded?f("Unshaded"):"")+(n.Flags&R.Unfogged?f("Unfogged"):"")+(n.Flags&R.XYQuad?f("XYQuad"):"")+(n.Squirt?f("Squirt"):"")+f(we(n.FrameFlags))+a()}function Me(n){return n.RibbonEmitters.map(xe).join("")}function xe(n){return l("RibbonEmitter",n.Name)+d(n)+r("HeightAbove",n.HeightAbove,null)+r("HeightBelow",n.HeightBelow,null)+r("Alpha",n.Alpha,null)+I("Color",n.Color,!0)+r("TextureSlot",n.TextureSlot,null)+r("Visibility",n.Visibility,1)+h("EmissionRate",n.EmissionRate)+h("LifeSpan",n.LifeSpan)+s("Gravity",n.Gravity,0)+h("Rows",n.Rows)+h("Columns",n.Columns)+h("MaterialID",n.MaterialID)+a()}function ve(n){return n.EventObjects.map(Be).join("")}function Ne(n){let e="";for(let t=0;t<n.length;++t)e+=g(2)+n[t]+`,
`;return l("EventTrack",n.length,1)+e+a(1)}function Be(n){return l("EventObject",n.Name)+d(n)+Ne(n.EventTrack)+a()}function De(n){return n.Cameras.map(Oe).join("")}function Oe(n){return l("Camera",n.Name)+k("FieldOfView",n.FieldOfView)+k("FarClip",n.FarClip)+k("NearClip",n.NearClip)+y("Position",n.Position)+r("Translation",n.Translation)+r("Rotation",n.Rotation)+l("Target",null,1)+y("Position",n.TargetPosition,null,2)+r("Translation",n.TargetTranslation,null,2)+a(1)+a()}function Ke(n){return n.CollisionShapes.map(He).join("")}function He(n){let e="";return n.Shape===K.Box?(e=f("Box"),e+=l("Vertices",2,1)+g(2)+A(n.Vertices.slice(0,3))+`,
`+g(2)+A(n.Vertices.slice(3,6))+`,
`+a(1)):(e=f("Sphere"),e+=l("Vertices",1,1)+g(2)+A(n.Vertices)+`,
`+a(1)+k("BoundsRadius",n.BoundsRadius)),l("CollisionShape",n.Name)+d(n)+e+a()}function je(n){return n.Version<900||!n.FaceFX?"":n.FaceFX.map(Ue).join("")}function Ue(n){return l("FaceFX",n.Name)+E("Path",n.Path)+a()}function $e(n){return n.Version<900||!n.BindPoses?"":n.BindPoses.map(qe).join("")}function qe(n){const e=l("Matrices",n.Matrices.length,1)+n.Matrices.map(t=>g(2)+A(t)+",").join(`
`)+`
`+a(1);return l("BindPose")+e+a()}function We(n){return n.Version<900||!n.ParticleEmitterPopcorns?"":n.ParticleEmitterPopcorns.map(_e).join("")}function _e(n){return l("ParticleEmitterPopcorn",n.Name)+d(n)+(n.Flags&U.Unshaded?f("Unshaded"):"")+(n.Flags&U.SortPrimsFarZ?f("SortPrimsFarZ"):"")+(n.Flags&U.Unfogged?f("Unfogged"):"")+r("LifeSpan",n.LifeSpan,null)+r("EmissionRate",n.EmissionRate,0)+r("Speed",n.Speed,0)+I("Color",n.Color,!0)+r("Alpha",n.Alpha,1)+s("ReplaceableId",n.ReplaceableId,0,null)+E("Path",n.Path,!1)+E("AnimVisibilityGuide",n.AnimVisibilityGuide,!1)+r("Visibility",n.Visibility)+a()}const Xe=[_n,Xn,Zn,Qn,Jn,mn,ie,re,he,ye,Ae,Ve,Le,Ee,Ce,Ie,Me,ve,De,Ke,je,$e,We];function kt(n){let e="";for(const t of Xe)e+=t(n);return e}const O=!0,V=-1;class Ze{constructor(e){this.ab=e,this.uint=new Uint8Array(this.ab),this.view=new DataView(this.ab),this.pos=0}keyword(e){this.uint[this.pos]=e.charCodeAt(0),this.uint[this.pos+1]=e.charCodeAt(1),this.uint[this.pos+2]=e.charCodeAt(2),this.uint[this.pos+3]=e.charCodeAt(3),this.pos+=4}uint8(e){this.view.setUint8(this.pos,e),this.pos+=1}uint16(e){this.view.setUint16(this.pos,e,O),this.pos+=2}int32(e){this.view.setInt32(this.pos,e,O),this.pos+=4}uint32(e){this.view.setUint32(this.pos,e,O),this.pos+=4}float32(e){this.view.setFloat32(this.pos,e,O),this.pos+=4}float32Array(e){for(let t=0;t<e.length;++t)this.float32(e[t])}uint8Array(e){for(let t=0;t<e.length;++t)this.uint8(e[t])}uint16Array(e){for(let t=0;t<e.length;++t)this.uint16(e[t])}int32Array(e){for(let t=0;t<e.length;++t)this.int32(e[t])}uint32Array(e){for(let t=0;t<e.length;++t)this.uint32(e[t])}str(e,t){for(let i=0;i<t;++i,++this.pos)this.uint[this.pos]=i<e.length?e.charCodeAt(i):0}animVector(e,t){const i=t===0;this.int32(e.Keys.length),this.int32(e.LineType),this.int32(e.GlobalSeqId!==null?e.GlobalSeqId:V);for(const u of e.Keys)this.int32(u.Frame),i?this.int32Array(u.Vector):this.float32Array(u.Vector),(e.LineType===P.Hermite||e.LineType===P.Bezier)&&(i?(this.int32Array(u.InTan),this.int32Array(u.OutTan)):(this.float32Array(u.InTan),this.float32Array(u.OutTan)))}}function H(n,e){e.float32(n.BoundsRadius||0);for(const t of["MinimumExtent","MaximumExtent"])e.float32Array(n[t])}const Ye={0:1,1:1,2:3,3:4};function o(n,e){return 12+n.Keys.length*(4+4*Ye[e]*(n.LineType===P.Hermite||n.LineType===P.Bezier?3:1))}function p(n){return n.reduce((e,t)=>e+t,0)}function Qe(){return 12}function Je(n,e){e.keyword("VERS"),e.int32(4),e.int32(n.Version)}const Q=336;function J(){return 8+Q+4+4*7+4}function ze(n,e){e.keyword("MODL"),e.int32(J()-8),e.str(n.Info.Name,Q),e.int32(0),H(n.Info,e),e.int32(n.Info.BlendTime)}const z=80;function me(){return z+4*2+4+4+4+4+4*7}function m(n){return n.Sequences.length?8+p(n.Sequences.map(me)):0}function nt(n,e){if(n.Sequences.length){e.keyword("SEQS"),e.int32(m(n)-8);for(const t of n.Sequences)e.str(t.Name,z),e.int32(t.Interval[0]),e.int32(t.Interval[1]),e.float32(t.MoveSpeed),e.int32(t.NonLooping?1:0),e.float32(t.Rarity),e.int32(0),H(t,e)}}function et(n){return!n.GlobalSequences||!n.GlobalSequences.length?0:8+4*n.GlobalSequences.length}function tt(n,e){if(!(!n.GlobalSequences||!n.GlobalSequences.length)){e.keyword("GLBS"),e.int32(n.GlobalSequences.length*4);for(const t of n.GlobalSequences)e.int32(t)}}function nn(n,e){return 28+(n.Version>=900?4:0)+(n.Version>=1e3?4*3+4+4:0)+(n.Version>=1100?8+B.reduce((t,i)=>t+(typeof e[i]<"u"?8+(typeof e[i]=="object"?4+o(e[i],0):0):0),0):0)+(e.Alpha!==null&&typeof e.Alpha!="number"?4+o(e.Alpha,1):0)+(n.Version<1100&&e.TextureID!==null&&typeof e.TextureID!="number"?4+o(e.TextureID,0):0)+(n.Version>=900&&e.EmissiveGain!==void 0&&e.EmissiveGain!==null&&typeof e.EmissiveGain!="number"?4+o(e.EmissiveGain,1):0)+(n.Version>=1e3&&e.FresnelColor!==void 0&&e.FresnelColor!==null&&!(e.FresnelColor instanceof Float32Array)?4+o(e.FresnelColor,2):0)+(n.Version>=1e3&&e.FresnelOpacity!==void 0&&e.FresnelOpacity!==null&&typeof e.FresnelOpacity!="number"?4+o(e.FresnelOpacity,1):0)+(n.Version>=1e3&&e.FresnelTeamColor!==void 0&&e.FresnelTeamColor!==null&&typeof e.FresnelTeamColor!="number"?4+o(e.FresnelTeamColor,1):0)}function en(n,e){return 20+(n.Version>=900&&n.Version<1100?80:0)+p(e.Layers.map(t=>nn(n,t)))}function tn(n){return n.Materials.length?8+p(n.Materials.map(e=>en(n,e))):0}function it(n,e){if(n.Materials.length){e.keyword("MTLS"),e.int32(tn(n)-8);for(const t of n.Materials){e.int32(en(n,t)),e.int32(t.PriorityPlane),e.int32(t.RenderMode),n.Version>=900&&n.Version<1100&&e.str(t.Shader||"",80),e.keyword("LAYS"),e.int32(t.Layers.length);for(const i of t.Layers){if(e.int32(nn(n,i)),e.int32(i.FilterMode),e.int32(i.Shading),e.int32(n.Version<1100&&typeof i.TextureID=="number"?i.TextureID:0),e.int32(i.TVertexAnimId!==null?i.TVertexAnimId:V),e.int32(i.CoordId),e.float32(typeof i.Alpha=="number"?i.Alpha:1),n.Version>=900&&(e.float32(typeof i.EmissiveGain=="number"?i.EmissiveGain:1),n.Version>=1e3&&(e.float32Array(i.FresnelColor instanceof Float32Array?i.FresnelColor:new Float32Array([1,1,1])),e.float32(typeof i.FresnelOpacity=="number"?i.FresnelOpacity:0),e.float32(typeof i.FresnelTeamColor=="number"?i.FresnelTeamColor:0))),n.Version>=1100){e.int32(i.ShaderTypeId||0);const u=B.filter(c=>i[c]!==void 0).length;e.int32(u);for(let c=0;c<B.length;++c){const G=i[B[c]];G!==void 0&&(e.int32(typeof G=="number"?G:0),e.int32(typeof G=="number"?c:0),typeof G=="object"&&(e.keyword("KMTF"),e.animVector(G,0)))}}i.Alpha&&typeof i.Alpha!="number"&&(e.keyword("KMTA"),e.animVector(i.Alpha,1)),n.Version<1100&&i.TextureID&&typeof i.TextureID!="number"&&(e.keyword("KMTF"),e.animVector(i.TextureID,0)),n.Version>=900&&i.EmissiveGain&&typeof i.EmissiveGain!="number"&&(e.keyword("KMTE"),e.animVector(i.EmissiveGain,1)),n.Version>=1e3&&i.FresnelColor&&!(i.FresnelColor instanceof Float32Array)&&(e.keyword("KFC3"),e.animVector(i.FresnelColor,2)),n.Version>=1e3&&i.FresnelOpacity&&typeof i.FresnelOpacity!="number"&&(e.keyword("KFCA"),e.animVector(i.FresnelOpacity,1)),n.Version>=1e3&&i.FresnelTeamColor&&typeof i.FresnelTeamColor!="number"&&(e.keyword("KFTC"),e.animVector(i.FresnelTeamColor,1))}}}}const on=256;function ot(){return 4+on+4+4}function rn(n){return n.Textures.length?8+p(n.Textures.map(e=>ot())):0}function rt(n,e){if(n.Textures.length){e.keyword("TEXS"),e.int32(rn(n)-8);for(const t of n.Textures)e.int32(t.ReplaceableId),e.str(t.Image,on),e.int32(0),e.int32(t.Flags)}}function un(n){return 4+(n.Translation?4+o(n.Translation,2):0)+(n.Rotation?4+o(n.Rotation,3):0)+(n.Scaling?4+o(n.Scaling,2):0)}function ln(n){return!n.TextureAnims||!n.TextureAnims.length?0:8+p(n.TextureAnims.map(e=>un(e)))}function ut(n,e){if(!(!n.TextureAnims||!n.TextureAnims.length)){e.keyword("TXAN"),e.int32(ln(n)-8);for(const t of n.TextureAnims)e.int32(un(t)),t.Translation&&(e.keyword("KTAT"),e.animVector(t.Translation,2)),t.Rotation&&(e.keyword("KTAR"),e.animVector(t.Rotation,3)),t.Scaling&&(e.keyword("KTAS"),e.animVector(t.Scaling,2))}}function an(n,e){var t,i;return 12+4*e.Vertices.length+4+4+4*e.Normals.length+4+4+4+4+4+4+4+4+2*e.Faces.length+4+4+e.VertexGroup.length+4+4+4*e.Groups.length+4+4+4*e.TotalGroupsCount+4+4+4+(n.Version>=900?84:0)+(n.Version>=900&&((t=e.Tangents)!=null&&t.length)?8+4*e.Tangents.length:0)+(n.Version>=900&&((i=e.SkinWeights)!=null&&i.length)?8+e.SkinWeights.length:0)+4*7+4+4*7*e.Anims.length+4+4+p(e.TVertices.map(u=>8+4*u.length))}function fn(n){return n.Geosets.length?8+p(n.Geosets.map(e=>an(n,e))):0}function lt(n,e){if(n.Geosets.length){e.keyword("GEOS"),e.int32(fn(n)-8);for(const t of n.Geosets){e.int32(an(n,t)),e.keyword("VRTX"),e.int32(t.Vertices.length/3),e.float32Array(t.Vertices),e.keyword("NRMS"),e.int32(t.Normals.length/3),e.float32Array(t.Normals),e.keyword("PTYP"),e.int32(1),e.int32(4),e.keyword("PCNT"),e.int32(1),e.int32(t.Faces.length),e.keyword("PVTX"),e.int32(t.Faces.length),e.uint16Array(t.Faces),e.keyword("GNDX"),e.int32(t.VertexGroup.length),e.uint8Array(t.VertexGroup),e.keyword("MTGC"),e.int32(t.Groups.length);for(let i=0;i<t.Groups.length;++i)e.int32(t.Groups[i].length);e.keyword("MATS"),e.int32(t.TotalGroupsCount);for(const i of t.Groups)for(const u of i)e.int32(u);e.int32(t.MaterialID),e.int32(t.SelectionGroup),e.int32(t.Unselectable?4:0),n.Version>=900&&(e.int32(typeof t.LevelOfDetail=="number"?t.LevelOfDetail:-1),e.str(t.Name||"",80)),H(t,e),e.int32(t.Anims.length);for(const i of t.Anims)H(i,e);n.Version>=900&&(t.Tangents&&t.Tangents.length&&(e.keyword("TANG"),e.int32(t.Tangents.length/4),e.float32Array(t.Tangents)),t.SkinWeights&&t.SkinWeights.length&&(e.keyword("SKIN"),e.int32(t.SkinWeights.length),e.uint8Array(t.SkinWeights))),e.keyword("UVAS"),e.int32(t.TVertices.length);for(const i of t.TVertices)e.keyword("UVBS"),e.int32(i.length/2),e.float32Array(i)}}}function sn(n){return 12+4*3+4+(typeof n.Alpha!="number"?4+o(n.Alpha,1):0)+(n.Color&&!(n.Color instanceof Float32Array)?4+o(n.Color,2):0)}function cn(n){return n.GeosetAnims.length?8+p(n.GeosetAnims.map(e=>sn(e))):0}function at(n,e){if(n.GeosetAnims.length){e.keyword("GEOA"),e.int32(cn(n)-8);for(const t of n.GeosetAnims)e.int32(sn(t)),e.float32(typeof t.Alpha=="number"?t.Alpha:1),e.int32(t.Flags),t.Color&&t.Color instanceof Float32Array?(e.float32(t.Color[0]),e.float32(t.Color[1]),e.float32(t.Color[2])):(e.float32(1),e.float32(1),e.float32(1)),e.int32(t.GeosetId!==null?t.GeosetId:V),t.Alpha!==null&&typeof t.Alpha!="number"&&(e.keyword("KGAO"),e.animVector(t.Alpha,1)),t.Color&&!(t.Color instanceof Float32Array)&&(e.keyword("KGAC"),e.animVector(t.Color,2))}}const hn=80;function b(n){return 4+hn+4+4+4+(n.Translation?4+o(n.Translation,2):0)+(n.Rotation?4+o(n.Rotation,3):0)+(n.Scaling?4+o(n.Scaling,2):0)}function ft(n){return b(n)+4+4}function gn(n){return n.Bones.length?8+p(n.Bones.map(ft)):0}function T(n,e){e.int32(b(n)),e.str(n.Name,hn),e.int32(n.ObjectId!==null?n.ObjectId:V),e.int32(n.Parent!==null?n.Parent:V),e.int32(n.Flags),n.Translation&&(e.keyword("KGTR"),e.animVector(n.Translation,2)),n.Rotation&&(e.keyword("KGRT"),e.animVector(n.Rotation,3)),n.Scaling&&(e.keyword("KGSC"),e.animVector(n.Scaling,2))}function st(n,e){if(n.Bones.length){e.keyword("BONE"),e.int32(gn(n)-8);for(const t of n.Bones)T(t,e),e.int32(t.GeosetId!==null?t.GeosetId:V),e.int32(t.GeosetAnimId!==null?t.GeosetAnimId:V)}}function pn(n){return 4+b(n)+4+4+4+4*3+4+4*3+4+(n.Visibility?4+o(n.Visibility,1):0)+(n.Color&&!(n.Color instanceof Float32Array)?4+o(n.Color,2):0)+(n.Intensity&&typeof n.Intensity!="number"?4+o(n.Intensity,1):0)+(n.AttenuationStart&&typeof n.AttenuationStart!="number"?4+o(n.AttenuationStart,1):0)+(n.AttenuationEnd&&typeof n.AttenuationEnd!="number"?4+o(n.AttenuationEnd,1):0)+(n.AmbColor&&!(n.AmbColor instanceof Float32Array)?4+o(n.AmbColor,2):0)+(n.AmbIntensity&&typeof n.AmbIntensity!="number"?4+o(n.AmbIntensity,1):0)}function yn(n){return n.Lights.length?8+p(n.Lights.map(pn)):0}function ct(n,e){if(n.Lights.length){e.keyword("LITE"),e.int32(yn(n)-8);for(const t of n.Lights)e.int32(pn(t)),T(t,e),e.int32(t.LightType),e.float32(typeof t.AttenuationStart=="number"?t.AttenuationStart:0),e.float32(typeof t.AttenuationEnd=="number"?t.AttenuationEnd:0),t.Color instanceof Float32Array?(e.float32(t.Color[0]),e.float32(t.Color[1]),e.float32(t.Color[2])):(e.float32(1),e.float32(1),e.float32(1)),e.float32(typeof t.Intensity=="number"?t.Intensity:0),t.AmbColor instanceof Float32Array?(e.float32(t.AmbColor[0]),e.float32(t.AmbColor[1]),e.float32(t.AmbColor[2])):(e.float32(1),e.float32(1),e.float32(1)),e.float32(typeof t.AmbIntensity=="number"?t.AmbIntensity:0),t.Intensity&&typeof t.Intensity!="number"&&(e.keyword("KLAI"),e.animVector(t.Intensity,1)),t.Visibility&&(e.keyword("KLAV"),e.animVector(t.Visibility,1)),t.Color&&!(t.Color instanceof Float32Array)&&(e.keyword("KLAC"),e.animVector(t.Color,2)),t.AmbColor&&!(t.AmbColor instanceof Float32Array)&&(e.keyword("KLBC"),e.animVector(t.AmbColor,2)),t.AmbIntensity&&typeof t.AmbIntensity!="number"&&(e.keyword("KLBI"),e.animVector(t.AmbIntensity,1)),t.AttenuationStart&&typeof t.AttenuationStart!="number"&&(e.keyword("KLAS"),e.animVector(t.AttenuationStart,0)),t.AttenuationEnd&&typeof t.AttenuationEnd!="number"&&(e.keyword("KLAE"),e.animVector(t.AttenuationEnd,0))}}function bn(n){return n.Helpers.length===0?0:8+p(n.Helpers.map(b))}function ht(n,e){if(n.Helpers.length!==0){e.keyword("HELP"),e.int32(bn(n)-8);for(const t of n.Helpers)T(t,e)}}const An=256;function dn(n){return 4+b(n)+An+4+4+(n.Visibility?4+o(n.Visibility,1):0)}function Tn(n){return n.Attachments.length===0?0:8+p(n.Attachments.map(dn))}function gt(n,e){if(n.Attachments.length!==0){e.keyword("ATCH"),e.int32(Tn(n)-8);for(const t of n.Attachments)e.int32(dn(t)),T(t,e),e.str(t.Path||"",An),e.int32(0),e.int32(t.AttachmentID),t.Visibility&&(e.keyword("KATV"),e.animVector(t.Visibility,1))}}function pt(n){return n.PivotPoints.length?8+4*3*n.PivotPoints.length:0}function yt(n,e){if(n.PivotPoints.length){e.keyword("PIVT"),e.int32(n.PivotPoints.length*4*3);for(const t of n.PivotPoints)e.float32Array(t)}}const Vn=256;function Sn(n){return 4+b(n)+4+4+4+4+Vn+4+4+4+(n.Visibility&&typeof n.Visibility!="number"?4+o(n.Visibility,1):0)+(n.EmissionRate&&typeof n.EmissionRate!="number"?4+o(n.EmissionRate,1):0)+(n.Gravity&&typeof n.Gravity!="number"?4+o(n.Gravity,1):0)+(n.Longitude&&typeof n.Longitude!="number"?4+o(n.Longitude,1):0)+(n.Latitude&&typeof n.Latitude!="number"?4+o(n.Latitude,1):0)+(n.LifeSpan&&typeof n.LifeSpan!="number"?4+o(n.LifeSpan,1):0)+(n.InitVelocity&&typeof n.InitVelocity!="number"?4+o(n.InitVelocity,1):0)}function Ln(n){return n.ParticleEmitters.length?8+p(n.ParticleEmitters.map(Sn)):0}function bt(n,e){if(n.ParticleEmitters.length){e.keyword("PREM"),e.int32(Ln(n)-8);for(const t of n.ParticleEmitters)e.int32(Sn(t)),T(t,e),e.float32(typeof t.EmissionRate=="number"?t.EmissionRate:0),e.float32(typeof t.Gravity=="number"?t.Gravity:0),e.float32(typeof t.Longitude=="number"?t.Longitude:0),e.float32(typeof t.Latitude=="number"?t.Latitude:0),e.str(t.Path,Vn),e.int32(0),e.float32(typeof t.LifeSpan=="number"?t.LifeSpan:0),e.float32(typeof t.InitVelocity=="number"?t.InitVelocity:0),t.Visibility&&typeof t.Visibility!="number"&&(e.keyword("KPEV"),e.animVector(t.Visibility,1)),t.EmissionRate&&typeof t.EmissionRate!="number"&&(e.keyword("KPEE"),e.animVector(t.EmissionRate,1)),t.Gravity&&typeof t.Gravity!="number"&&(e.keyword("KPEG"),e.animVector(t.Gravity,1)),t.Longitude&&typeof t.Longitude!="number"&&(e.keyword("KPLN"),e.animVector(t.Longitude,1)),t.Latitude&&typeof t.Latitude!="number"&&(e.keyword("KPLT"),e.animVector(t.Latitude,1)),t.LifeSpan&&typeof t.LifeSpan!="number"&&(e.keyword("KPEL"),e.animVector(t.LifeSpan,1)),t.InitVelocity&&typeof t.InitVelocity!="number"&&(e.keyword("KPES"),e.animVector(t.InitVelocity,1))}}function Pn(n){return 4+b(n)+4+4+4+4+4+4+4+4+4+4+4+4+4+4+4*3*3+3+4*3+4*3+4*3+4*3+4*3+4+4+4+4+(n.Visibility&&typeof n.Visibility!="number"?4+o(n.Visibility,1):0)+(n.EmissionRate&&typeof n.EmissionRate!="number"?4+o(n.EmissionRate,1):0)+(n.Width&&typeof n.Width!="number"?4+o(n.Width,1):0)+(n.Length&&typeof n.Length!="number"?4+o(n.Length,1):0)+(n.Speed&&typeof n.Speed!="number"?4+o(n.Speed,1):0)+(n.Latitude&&typeof n.Latitude!="number"?4+o(n.Latitude,1):0)+(n.Gravity&&typeof n.Gravity!="number"?4+o(n.Gravity,1):0)+(n.Variation&&typeof n.Variation!="number"?4+o(n.Variation,1):0)}function En(n){return n.ParticleEmitters2.length?8+p(n.ParticleEmitters2.map(Pn)):0}function At(n,e){if(n.ParticleEmitters2.length){e.keyword("PRE2"),e.int32(En(n)-8);for(const t of n.ParticleEmitters2){e.int32(Pn(t)),T(t,e),e.float32(typeof t.Speed=="number"?t.Speed:0),e.float32(typeof t.Variation=="number"?t.Variation:0),e.float32(typeof t.Latitude=="number"?t.Latitude:0),e.float32(typeof t.Gravity=="number"?t.Gravity:0),e.float32(t.LifeSpan),e.float32(typeof t.EmissionRate=="number"?t.EmissionRate:0),e.float32(typeof t.Width=="number"?t.Width:0),e.float32(typeof t.Length=="number"?t.Length:0),e.int32(t.FilterMode),e.int32(t.Rows),e.int32(t.Columns),t.FrameFlags&L.Head&&t.FrameFlags&L.Tail?e.int32(2):t.FrameFlags&L.Tail?e.int32(1):t.FrameFlags&L.Head&&e.int32(0),e.float32(t.TailLength),e.float32(t.Time);for(let i=0;i<3;++i)for(let u=0;u<3;++u)e.float32(t.SegmentColor[i][u]);for(let i=0;i<3;++i)e.uint8(t.Alpha[i]);for(let i=0;i<3;++i)e.float32(t.ParticleScaling[i]);for(const i of["LifeSpanUVAnim","DecayUVAnim","TailUVAnim","TailDecayUVAnim"])for(let u=0;u<3;++u)e.int32(t[i][u]);e.int32(t.TextureID!==null?t.TextureID:V),e.int32(t.Squirt?1:0),e.int32(t.PriorityPlane),e.int32(t.ReplaceableId),t.Speed&&typeof t.Speed!="number"&&(e.keyword("KP2S"),e.animVector(t.Speed,1)),t.Latitude&&typeof t.Latitude!="number"&&(e.keyword("KP2L"),e.animVector(t.Latitude,1)),t.EmissionRate&&typeof t.EmissionRate!="number"&&(e.keyword("KP2E"),e.animVector(t.EmissionRate,1)),t.Visibility&&typeof t.Visibility!="number"&&(e.keyword("KP2V"),e.animVector(t.Visibility,1)),t.Length&&typeof t.Length!="number"&&(e.keyword("KP2N"),e.animVector(t.Length,1)),t.Width&&typeof t.Width!="number"&&(e.keyword("KP2W"),e.animVector(t.Width,1)),t.Gravity&&typeof t.Gravity!="number"&&(e.keyword("KP2G"),e.animVector(t.Gravity,1)),t.Variation&&typeof t.Variation!="number"&&(e.keyword("KP2R"),e.animVector(t.Variation,1))}}}function Cn(n){return 4+b(n)+4+4+4+4*3+4+4+4+4+4+4+4+(n.Visibility?4+o(n.Visibility,1):0)+(typeof n.HeightAbove!="number"?4+o(n.HeightAbove,1):0)+(typeof n.HeightBelow!="number"?4+o(n.HeightBelow,1):0)+(typeof n.Alpha!="number"?4+o(n.Alpha,1):0)+(typeof n.TextureSlot!="number"?4+o(n.TextureSlot,1):0)}function Fn(n){return n.RibbonEmitters.length?8+p(n.RibbonEmitters.map(Cn)):0}function dt(n,e){if(n.RibbonEmitters.length){e.keyword("RIBB"),e.int32(Fn(n)-8);for(const t of n.RibbonEmitters)e.int32(Cn(t)),T(t,e),e.float32(typeof t.HeightAbove=="number"?t.HeightAbove:0),e.float32(typeof t.HeightBelow=="number"?t.HeightBelow:0),e.float32(typeof t.Alpha=="number"?t.Alpha:0),t.Color?e.float32Array(t.Color):(e.float32(1),e.float32(1),e.float32(1)),e.float32(t.LifeSpan),e.int32(typeof t.TextureSlot=="number"?t.TextureSlot:0),e.int32(t.EmissionRate),e.int32(t.Rows),e.int32(t.Columns),e.int32(t.MaterialID),e.float32(t.Gravity),t.Visibility&&(e.keyword("KRVS"),e.animVector(t.Visibility,1)),typeof t.HeightAbove!="number"&&(e.keyword("KRHA"),e.animVector(t.HeightAbove,1)),typeof t.HeightBelow!="number"&&(e.keyword("KRHB"),e.animVector(t.HeightBelow,1)),typeof t.Alpha!="number"&&(e.keyword("KRAL"),e.animVector(t.Alpha,1)),typeof t.TextureSlot!="number"&&(e.keyword("KRTX"),e.animVector(t.TextureSlot,0))}}const In=80;function Gn(n){return 4+In+4*3+4+4+4+4*3+(n.Translation?4+o(n.Translation,2):0)+(n.TargetTranslation?4+o(n.TargetTranslation,2):0)+(n.Rotation?4+o(n.Rotation,1):0)}function Rn(n){return n.Cameras.length?8+p(n.Cameras.map(Gn)):0}function Tt(n,e){if(n.Cameras.length){e.keyword("CAMS"),e.int32(Rn(n)-8);for(const t of n.Cameras)e.int32(Gn(t)),e.str(t.Name,In),e.float32Array(t.Position),e.float32(t.FieldOfView),e.float32(t.FarClip),e.float32(t.NearClip),e.float32Array(t.TargetPosition),t.Translation&&(e.keyword("KCTR"),e.animVector(t.Translation,2)),t.Rotation&&(e.keyword("KCRL"),e.animVector(t.Rotation,1)),t.TargetTranslation&&(e.keyword("KTTR"),e.animVector(t.TargetTranslation,2))}}function Vt(n){return b(n)+4+4+4+4*n.EventTrack.length}function wn(n){return n.EventObjects.length===0?0:8+p(n.EventObjects.map(Vt))}function St(n,e){if(n.EventObjects.length!==0){e.keyword("EVTS"),e.int32(wn(n)-8);for(const t of n.EventObjects)T(t,e),e.keyword("KEVT"),e.int32(t.EventTrack.length),e.int32(V),e.uint32Array(t.EventTrack)}}function Lt(n){return b(n)+4+(n.Shape===K.Box?6:3)*4+(n.Shape===K.Sphere?4:0)}function kn(n){return n.CollisionShapes.length===0?0:8+p(n.CollisionShapes.map(Lt))}function Pt(n,e){if(n.CollisionShapes.length!==0){e.keyword("CLID"),e.int32(kn(n)-8);for(const t of n.CollisionShapes)T(t,e),e.int32(t.Shape),e.float32Array(t.Vertices),t.Shape===K.Sphere&&e.float32(t.BoundsRadius)}}function Mn(n){return n.Version<900||!n.FaceFX?0:8+340*n.FaceFX.length}function Et(n,e){if(!(n.Version<900||!n.FaceFX)){e.keyword("FAFX"),e.int32(Mn(n)-8);for(const t of n.FaceFX)e.str(t.Name,80),e.str(t.Path,260)}}function Ct(n){return 4*12*n.Matrices.length}function xn(n){return n.Version<900||!n.BindPoses?0:12+p(n.BindPoses.map(Ct))}function Ft(n,e){var i;if(n.Version<900||!((i=n.BindPoses)!=null&&i.length))return;e.keyword("BPOS"),e.int32(xn(n)-8);const t=n.BindPoses.reduce((u,c)=>u+c.Matrices.length,0);e.int32(t);for(const u of n.BindPoses)for(const c of u.Matrices)e.float32Array(c)}function vn(n){return 4+b(n)+4+4+4+4*3+4+4+260+260+(n.Alpha&&typeof n.Alpha!="number"?4+o(n.Alpha,1):0)+(n.Visibility&&typeof n.Visibility!="number"?4+o(n.Visibility,1):0)+(n.EmissionRate&&typeof n.EmissionRate!="number"?4+o(n.EmissionRate,1):0)+(n.Color&&!(n.Color instanceof Float32Array)?4+o(n.Color,2):0)+(n.LifeSpan&&typeof n.LifeSpan!="number"?4+o(n.LifeSpan,1):0)+(n.Speed&&typeof n.Speed!="number"?4+o(n.Speed,1):0)}function Nn(n){var e;return n.Version<900||!((e=n.ParticleEmitterPopcorns)!=null&&e.length)?0:8+p(n.ParticleEmitterPopcorns.map(vn))}function It(n,e){var t;if(!(n.Version<900||!((t=n.ParticleEmitterPopcorns)!=null&&t.length))){e.keyword("CORN"),e.int32(Nn(n)-8);for(const i of n.ParticleEmitterPopcorns)e.int32(vn(i)),T(i,e),e.float32(typeof i.LifeSpan=="number"?i.LifeSpan:0),e.float32(typeof i.EmissionRate=="number"?i.EmissionRate:1),e.float32(typeof i.Speed=="number"?i.Speed:0),i.Color instanceof Float32Array?(e.float32(i.Color[0]),e.float32(i.Color[1]),e.float32(i.Color[2])):(e.float32(1),e.float32(1),e.float32(1)),e.float32(typeof i.Alpha=="number"?i.Alpha:1),e.int32(typeof i.ReplaceableId=="number"?i.ReplaceableId:0),e.str(i.Path,260),e.str(i.AnimVisibilityGuide,260),i.Alpha&&typeof i.Alpha!="number"&&(e.keyword("KPPA"),e.animVector(i.Alpha,1)),i.Color&&!(i.Color instanceof Float32Array)&&(e.keyword("KPPC"),e.animVector(i.Color,2)),i.EmissionRate&&typeof i.EmissionRate!="number"&&(e.keyword("KPPE"),e.animVector(i.EmissionRate,1)),i.LifeSpan&&typeof i.LifeSpan!="number"&&(e.keyword("KPPL"),e.animVector(i.LifeSpan,1)),i.Speed&&typeof i.Speed!="number"&&(e.keyword("KPPS"),e.animVector(i.Speed,1)),i.Visibility&&typeof i.Visibility!="number"&&(e.keyword("KPPV"),e.animVector(i.Visibility,1))}}const Gt=[Qe,J,m,et,tn,rn,ln,fn,cn,gn,yn,bn,Tn,pt,Ln,En,Nn,Fn,Rn,wn,kn,Mn,xn],Rt=[Je,ze,nt,tt,it,rt,ut,lt,at,st,ct,ht,gt,yt,bt,At,It,dt,Tt,St,Pt,Et,Ft];function Mt(n){let e=4;for(const u of Gt)e+=u(n);const t=new ArrayBuffer(e),i=new Ze(t);i.keyword("MDLX");for(const u of Rt)u(n,i);return t}export{Mt as a,kt as g};
