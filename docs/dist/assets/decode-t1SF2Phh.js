/*!
    war3-model v4.0.0
	https://github.com/4eb0da/war3-model
	Released under the MIT License.
*/var ge=function(){var l=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),C=4017,T=799,A=3406,B=2276,S=1567,W=3784,X=5793,ie=2896;function Z(){}function he(y,s){for(var e=0,m=[],d,r,f=16;f>0&&!y[f-1];)f--;m.push({children:[],index:0});var v=m[0],a;for(d=0;d<f;d++){for(r=0;r<y[d];r++){for(v=m.pop(),v.children[v.index]=s[e];v.index>0;)v=m.pop();for(v.index++,m.push(v);m.length<=d;)m.push(a={children:[],index:0}),v.children[v.index]=a.children,v=a;e++}d+1<f&&(m.push(a={children:[],index:0}),v.children[v.index]=a.children,v=a)}return m[0].children}function U(y,s,e){return 64*((y.blocksPerLine+1)*s+e)}function te(y,s,e,m,d,r,f,v,a){e.precision,e.samplesPerLine,e.scanLines;var b=e.mcusPerLine,g=e.progressive;e.maxH,e.maxV;var F=s,i=0,o=0;function t(){if(o>0)return o--,i>>o&1;if(i=y[s++],i==255){var h=y[s++];if(h)throw"unexpected marker: "+(i<<8|h).toString(16)}return o=7,i>>>7}function n(h){for(var k=h,P;(P=t())!==null;){if(k=k[P],typeof k=="number")return k;if(typeof k!="object")throw"invalid huffman sequence"}return null}function D(h){for(var k=0;h>0;){var P=t();if(P===null)return;k=k<<1|P,h--}return k}function u(h){var k=D(h);return k>=1<<h-1?k:k+(-1<<h)+1}function ne(h,k){var P=n(h.huffmanTableDC),J=P===0?0:u(P);h.blockData[k]=h.pred+=J;for(var x=1;x<64;){var w=n(h.huffmanTableAC),L=w&15,M=w>>4;if(L===0){if(M<15)break;x+=16;continue}x+=M;var ve=l[x];h.blockData[k+ve]=u(L),x++}}function K(h,k){var P=n(h.huffmanTableDC),J=P===0?0:u(P)<<a;h.blockData[k]=h.pred+=J}function Y(h,k){h.blockData[k]|=t()<<a}var I=0;function q(h,k){if(I>0){I--;return}for(var P=r,J=f;P<=J;){var x=n(h.huffmanTableAC),w=x&15,L=x>>4;if(w===0){if(L<15){I=D(L)+(1<<L)-1;break}P+=16;continue}P+=L;var M=l[P];h.blockData[k+M]=u(w)*(1<<a),P++}}var G=0,z;function $(h,k){for(var P=r,J=f,x=0;P<=J;){var w=l[P];switch(G){case 0:var L=n(h.huffmanTableAC),M=L&15,x=L>>4;if(M===0)x<15?(I=D(x)+(1<<x),G=4):(x=16,G=1);else{if(M!==1)throw"invalid ACn encoding";z=u(M),G=x?2:3}continue;case 1:case 2:h.blockData[k+w]?h.blockData[k+w]+=t()<<a:(x--,x===0&&(G=G==2?3:0));break;case 3:h.blockData[k+w]?h.blockData[k+w]+=t()<<a:(h.blockData[k+w]=z<<a,G=0);break;case 4:h.blockData[k+w]&&(h.blockData[k+w]+=t()<<a);break}P++}G===4&&(I--,I===0&&(G=0))}function _(h,k,P,J,x){var w=P/b|0,L=P%b,M=w*h.v+J,ve=L*h.h+x,le=U(h,M,ve);k(h,le)}function Q(h,k,P){var J=P/h.blocksPerLine|0,x=P%h.blocksPerLine,w=U(h,J,x);k(h,w)}var H=m.length,V,N,j,p,O,R;g?r===0?R=v===0?K:Y:R=v===0?q:$:R=ne;var ee=0,re,E;H==1?E=m[0].blocksPerLine*m[0].blocksPerColumn:E=b*e.mcusPerColumn,d||(d=E);for(var ue,se;ee<E;){for(N=0;N<H;N++)m[N].pred=0;if(I=0,H==1)for(V=m[0],O=0;O<d;O++)Q(V,R,ee),ee++;else for(O=0;O<d;O++){for(N=0;N<H;N++)for(V=m[N],ue=V.h,se=V.v,j=0;j<se;j++)for(p=0;p<ue;p++)_(V,R,ee,j,p);ee++}if(o=0,re=y[s]<<8|y[s+1],re<=65280)throw"marker was not found";if(re>=65488&&re<=65495)s+=2;else break}return s-F}function de(y,s,e){var m=y.quantizationTable,d,r,f,v,a,b,g,F,i,o;for(o=0;o<64;o++)e[o]=y.blockData[s+o]*m[o];for(o=0;o<8;++o){var t=8*o;if(e[1+t]==0&&e[2+t]==0&&e[3+t]==0&&e[4+t]==0&&e[5+t]==0&&e[6+t]==0&&e[7+t]==0){i=X*e[0+t]+512>>10,e[0+t]=i,e[1+t]=i,e[2+t]=i,e[3+t]=i,e[4+t]=i,e[5+t]=i,e[6+t]=i,e[7+t]=i;continue}d=X*e[0+t]+128>>8,r=X*e[4+t]+128>>8,f=e[2+t],v=e[6+t],a=ie*(e[1+t]-e[7+t])+128>>8,F=ie*(e[1+t]+e[7+t])+128>>8,b=e[3+t]<<4,g=e[5+t]<<4,i=d-r+1>>1,d=d+r+1>>1,r=i,i=f*W+v*S+128>>8,f=f*S-v*W+128>>8,v=i,i=a-g+1>>1,a=a+g+1>>1,g=i,i=F+b+1>>1,b=F-b+1>>1,F=i,i=d-v+1>>1,d=d+v+1>>1,v=i,i=r-f+1>>1,r=r+f+1>>1,f=i,i=a*B+F*A+2048>>12,a=a*A-F*B+2048>>12,F=i,i=b*T+g*C+2048>>12,b=b*C-g*T+2048>>12,g=i,e[0+t]=d+F,e[7+t]=d-F,e[1+t]=r+g,e[6+t]=r-g,e[2+t]=f+b,e[5+t]=f-b,e[3+t]=v+a,e[4+t]=v-a}for(o=0;o<8;++o){var n=o;if(e[8+n]==0&&e[16+n]==0&&e[24+n]==0&&e[32+n]==0&&e[40+n]==0&&e[48+n]==0&&e[56+n]==0){i=X*e[o+0]+8192>>14,e[0+n]=i,e[8+n]=i,e[16+n]=i,e[24+n]=i,e[32+n]=i,e[40+n]=i,e[48+n]=i,e[56+n]=i;continue}d=X*e[0+n]+2048>>12,r=X*e[32+n]+2048>>12,f=e[16+n],v=e[48+n],a=ie*(e[8+n]-e[56+n])+2048>>12,F=ie*(e[8+n]+e[56+n])+2048>>12,b=e[24+n],g=e[40+n],i=d-r+1>>1,d=d+r+1>>1,r=i,i=f*W+v*S+2048>>12,f=f*S-v*W+2048>>12,v=i,i=a-g+1>>1,a=a+g+1>>1,g=i,i=F+b+1>>1,b=F-b+1>>1,F=i,i=d-v+1>>1,d=d+v+1>>1,v=i,i=r-f+1>>1,r=r+f+1>>1,f=i,i=a*B+F*A+2048>>12,a=a*A-F*B+2048>>12,F=i,i=b*T+g*C+2048>>12,b=b*C-g*T+2048>>12,g=i,e[0+n]=d+F,e[56+n]=d-F,e[8+n]=r+g,e[48+n]=r-g,e[16+n]=f+b,e[40+n]=f-b,e[24+n]=v+a,e[32+n]=v-a}for(o=0;o<64;++o){var D=s+o,u=e[o];u=u<=-2056?0:u>=2024?255:u+2056>>4,y.blockData[D]=u}}function Fe(y,s){for(var e=s.blocksPerLine,m=s.blocksPerColumn,d=new Int32Array(64),r=0;r<m;r++)for(var f=0;f<e;f++){var v=U(s,r,f);de(s,v,d)}return s.blockData}function ce(y){return y<=0?0:y>=255?255:y|0}return Z.prototype={load:function(s){var e=new XMLHttpRequest;e.open("GET",s,!0),e.responseType="arraybuffer",e.onload=(function(){var m=new Uint8Array(e.response||e.mozResponseArrayBuffer);this.parse(m),this.onload&&this.onload()}).bind(this),e.send(null)},loadFromBuffer:function(s){this.parse(s),this.onload&&this.onload()},parse:function(s){function e(){var x=s[r]<<8|s[r+1];return r+=2,x}function m(){var x=e(),w=s.subarray(r,r+x-2);return r+=w.length,w}function d(x){for(var w=Math.ceil(x.samplesPerLine/8/x.maxH),L=Math.ceil(x.scanLines/8/x.maxV),M=0;M<x.components.length;M++){E=x.components[M];var ve=Math.ceil(Math.ceil(x.samplesPerLine/8)*E.h/x.maxH),le=Math.ceil(Math.ceil(x.scanLines/8)*E.v/x.maxV),xe=w*E.h,be=L*E.v,ke=64*be*(xe+1);E.blockData=new Int16Array(ke),E.blocksPerLine=ve,E.blocksPerColumn=le}x.mcusPerLine=w,x.mcusPerColumn=L}var r=0;s.length;var f=null,v=null,a,b,g=[],F=[],i=[],o=e();if(o!=65496)throw"SOI not found";for(o=e();o!=65497;){var t,n,D;switch(o){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var u=m();o===65504&&u[0]===74&&u[1]===70&&u[2]===73&&u[3]===70&&u[4]===0&&(f={version:{major:u[5],minor:u[6]},densityUnits:u[7],xDensity:u[8]<<8|u[9],yDensity:u[10]<<8|u[11],thumbWidth:u[12],thumbHeight:u[13],thumbData:u.subarray(14,14+3*u[12]*u[13])}),o===65518&&u[0]===65&&u[1]===100&&u[2]===111&&u[3]===98&&u[4]===101&&u[5]===0&&(v={version:u[6],flags0:u[7]<<8|u[8],flags1:u[9]<<8|u[10],transformCode:u[11]});break;case 65499:for(var ne=e(),K=ne+r-2;r<K;){var Y=s[r++],I=new Int32Array(64);if(Y>>4===0)for(n=0;n<64;n++){var q=l[n];I[q]=s[r++]}else if(Y>>4===1)for(n=0;n<64;n++){var q=l[n];I[q]=e()}else throw"DQT: invalid table spec";g[Y&15]=I}break;case 65472:case 65473:case 65474:if(a)throw"Only single frame JPEGs supported";e(),a={},a.extended=o===65473,a.progressive=o===65474,a.precision=s[r++],a.scanLines=e(),a.samplesPerLine=e(),a.components=[],a.componentIds={};var G=s[r++],z,$=0,_=0;for(t=0;t<G;t++){z=s[r];var Q=s[r+1]>>4,H=s[r+1]&15;$<Q&&($=Q),_<H&&(_=H);var V=s[r+2],D=a.components.push({h:Q,v:H,quantizationTable:g[V]});a.componentIds[z]=D-1,r+=3}a.maxH=$,a.maxV=_,d(a);break;case 65476:var N=e();for(t=2;t<N;){var j=s[r++],p=new Uint8Array(16),O=0;for(n=0;n<16;n++,r++)O+=p[n]=s[r];var R=new Uint8Array(O);for(n=0;n<O;n++,r++)R[n]=s[r];t+=17+O,(j>>4===0?i:F)[j&15]=he(p,R)}break;case 65501:e(),b=e();break;case 65498:e();var ee=s[r++],re=[],E;for(t=0;t<ee;t++){var ue=a.componentIds[s[r++]];E=a.components[ue];var se=s[r++];E.huffmanTableDC=i[se>>4],E.huffmanTableAC=F[se&15],re.push(E)}var h=s[r++],k=s[r++],P=s[r++],J=te(s,r,a,re,b,h,k,P>>4,P&15);r+=J;break;default:if(s[r-3]==255&&s[r-2]>=192&&s[r-2]<=254){r-=3;break}throw"unknown JPEG marker "+o.toString(16)}o=e()}this.width=a.samplesPerLine,this.height=a.scanLines,this.jfif=f,this.adobe=v,this.components=[];for(var t=0;t<a.components.length;t++){var E=a.components[t];this.components.push({output:Fe(a,E),scaleX:E.h/a.maxH,scaleY:E.v/a.maxV,blocksPerLine:E.blocksPerLine,blocksPerColumn:E.blocksPerColumn})}},getData:function(s,e,m){var d=this.width/e,r=this.height/m,f,v,a,b,g,F,i=0,o=this.components.length,t=s.data,n=new Uint8Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(F=0;F<o;F++){f=this.components[F<3?2-F:F];for(var D=f.blocksPerLine,u=f.blocksPerColumn,ne=D<<3,K,Y,I=0,q=0;q<u;q++)for(var G=q<<3,z=0;z<D;z++){var $=U(f,q,z),i=0,_=z<<3;for(K=0;K<8;K++){var I=(G+K)*ne;for(Y=0;Y<8;Y++)n[I+_+Y]=f.output[$+i++]}}v=f.scaleX*d,a=f.scaleY*r,i=F;var Q,H,V;for(g=0;g<m;g++)for(b=0;b<e;b++)H=0|g*a,Q=0|b*v,V=H*ne+Q,t[i]=n[V],i+=o}return t},copyToImageData:function(s){var e=s.width,m=s.height,d=e*m*4,r=s.data,f=this.getData(e,m),v=0,a=0,b,g,F,i,o,t,n,D,u;switch(this.components.length){case 1:for(;a<d;)F=f[v++],r[a++]=F,r[a++]=F,r[a++]=F,r[a++]=255;break;case 3:for(;a<d;)n=f[v++],D=f[v++],u=f[v++],r[a++]=n,r[a++]=D,r[a++]=u,r[a++]=255;break;case 4:for(;a<d;)o=f[v++],t=f[v++],F=f[v++],i=f[v++],b=255-i,g=b/255,n=ce(b-o*g),D=ce(b-t*g),u=ce(b-F*g),r[a++]=n,r[a++]=D,r[a++]=u,r[a++]=255;break;default:throw"Unsupported color mode"}}},Z}();function me(c){const l=new ge;l.loadFromBuffer(c);var C;return typeof ImageData<"u"?C=new ImageData(l.width,l.height):C={width:l.width,height:l.height,data:new Uint8ClampedArray(l.width*l.height*4)},l.getData(C,l.width,l.height),C}var oe=(c=>(c[c.BLP0=0]="BLP0",c[c.BLP1=1]="BLP1",c[c.BLP2=2]="BLP2",c))(oe||{}),fe=(c=>(c[c.JPEG=0]="JPEG",c[c.Direct=1]="Direct",c))(fe||{});function Pe(c,l){return String.fromCharCode(c.getUint8(l),c.getUint8(l+1),c.getUint8(l+2),c.getUint8(l+3))}function ae(c,l){return c.getUint32(l*4,!0)}function Ce(c,l,C){const T=c[Math.floor(C*l/8)],A=8/l;return T>>A-C%A-1&(1<<l)-1}function ye(c,l){return typeof ImageData<"u"?new ImageData(c,l):{width:c,height:l,data:new Uint8ClampedArray(c*l*4),colorSpace:"srgb"}}function Ee(c){const l=new DataView(c),C={type:oe.BLP1,width:0,height:0,content:fe.JPEG,alphaBits:0,mipmaps:[],data:c},T=Pe(l,0);if(T==="BLP0"||T==="BLP2")throw new Error("BLP0/BLP2 not supported");if(T!=="BLP1")throw new Error("Not a blp image");if(C.content=ae(l,1),C.content!==fe.JPEG&&C.content!==fe.Direct)throw new Error("Unknown BLP content");C.alphaBits=ae(l,2),C.width=ae(l,3),C.height=ae(l,4);for(let A=0;A<16;++A){const B={offset:ae(l,7+A),size:ae(l,23+A)};if(B.size>0)C.mipmaps.push(B);else break}return C}function we(c,l){const C=new DataView(c.data),T=new Uint8Array(c.data),A=c.mipmaps[l];if(c.content===fe.JPEG){const B=ae(C,39),S=new Uint8Array(B+A.size);return S.set(T.subarray(40*4,40*4+B)),S.set(T.subarray(A.offset,A.offset+A.size),B),me(S)}else{const B=new Uint8Array(c.data,156,1024),S=c.width/(1<<l),W=c.height/(1<<l),X=S*W,ie=new Uint8Array(c.data,A.offset+X,Math.ceil(X*c.alphaBits/8)),Z=ye(S,W),he=255/((1<<c.alphaBits)-1);for(let U=0;U<X;++U){const te=C.getUint8(A.offset+U)*4;Z.data[U*4]=B[te+2],Z.data[U*4+1]=B[te+1],Z.data[U*4+2]=B[te],c.alphaBits>0?Z.data[U*4+3]=Ce(ie,c.alphaBits,U)*he:Z.data[U*4+3]=255}return Z}}export{Ee as d,we as g};
