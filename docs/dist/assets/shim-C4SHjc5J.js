/*!
    war3-model v4.0.0
	https://github.com/4eb0da/war3-model
	Released under the MIT License.
*/var _=(n=>(n[n.WrapWidth=1]="WrapWidth",n[n.WrapHeight=2]="WrapHeight",n))(_||{}),Z=(n=>(n[n.None=0]="None",n[n.Transparent=1]="Transparent",n[n.Blend=2]="Blend",n[n.Additive=3]="Additive",n[n.AddAlpha=4]="AddAlpha",n[n.Modulate=5]="Modulate",n[n.Modulate2x=6]="Modulate2x",n))(Z||{}),G=(n=>(n[n.DontInterp=0]="DontInterp",n[n.Linear=1]="Linear",n[n.Hermite=2]="Hermite",n[n.Bezier=3]="Bezier",n))(G||{}),Y=(n=>(n[n.Unshaded=1]="Unshaded",n[n.SphereEnvMap=2]="SphereEnvMap",n[n.TwoSided=16]="TwoSided",n[n.Unfogged=32]="Unfogged",n[n.NoDepthTest=64]="NoDepthTest",n[n.NoDepthSet=128]="NoDepthSet",n))(Y||{}),Q=(n=>(n[n.ConstantColor=1]="ConstantColor",n[n.SortPrimsFarZ=16]="SortPrimsFarZ",n[n.FullResolution=32]="FullResolution",n))(Q||{}),J=(n=>(n[n.DropShadow=1]="DropShadow",n[n.Color=2]="Color",n))(J||{}),C=(n=>(n[n.DontInheritTranslation=1]="DontInheritTranslation",n[n.DontInheritRotation=2]="DontInheritRotation",n[n.DontInheritScaling=4]="DontInheritScaling",n[n.Billboarded=8]="Billboarded",n[n.BillboardedLockX=16]="BillboardedLockX",n[n.BillboardedLockY=32]="BillboardedLockY",n[n.BillboardedLockZ=64]="BillboardedLockZ",n[n.CameraAnchored=128]="CameraAnchored",n))(C||{}),x=(n=>(n[n.Helper=0]="Helper",n[n.Bone=256]="Bone",n[n.Light=512]="Light",n[n.EventObject=1024]="EventObject",n[n.Attachment=2048]="Attachment",n[n.ParticleEmitter=4096]="ParticleEmitter",n[n.CollisionShape=8192]="CollisionShape",n[n.RibbonEmitter=16384]="RibbonEmitter",n))(x||{}),L=(n=>(n[n.Box=0]="Box",n[n.Sphere=2]="Sphere",n))(L||{}),nn=(n=>(n[n.EmitterUsesMDL=32768]="EmitterUsesMDL",n[n.EmitterUsesTGA=65536]="EmitterUsesTGA",n))(nn||{}),on=(n=>(n[n.Unshaded=32768]="Unshaded",n[n.SortPrimsFarZ=65536]="SortPrimsFarZ",n[n.LineEmitter=131072]="LineEmitter",n[n.Unfogged=262144]="Unfogged",n[n.ModelSpace=524288]="ModelSpace",n[n.XYQuad=1048576]="XYQuad",n))(on||{}),en=(n=>(n[n.Blend=0]="Blend",n[n.Additive=1]="Additive",n[n.Modulate=2]="Modulate",n[n.Modulate2x=3]="Modulate2x",n[n.AlphaKey=4]="AlphaKey",n))(en||{}),F=(n=>(n[n.Head=1]="Head",n[n.Tail=2]="Tail",n))(F||{}),rn=(n=>(n[n.Omnidirectional=0]="Omnidirectional",n[n.Directional=1]="Directional",n[n.Ambient=2]="Ambient",n))(rn||{}),N=(n=>(n[n.Unshaded=32768]="Unshaded",n[n.SortPrimsFarZ=65536]="SortPrimsFarZ",n[n.Unfogged=262144]="Unfogged",n))(N||{});function yi(n,i,r){const e=i[0],o=i[1],c=i[2],l=i[3],s=e+e,f=o+o,u=c+c,S=e*s,I=e*f,T=e*u,V=o*f,K=o*u,E=c*u,B=l*s,p=l*f,b=l*u,R=r[0],g=r[1],M=r[2];return n[0]=1-(V+E),n[1]=I+b,n[2]=T-p,n[3]=0,n[4]=I-b,n[5]=1-(S+E),n[6]=K+B,n[7]=0,n[8]=T+p,n[9]=K-B,n[10]=1-(S+V),n[11]=0,n[12]=R-(n[0]*R+n[4]*g+n[8]*M),n[13]=g-(n[1]*R+n[5]*g+n[9]*M),n[14]=M-(n[2]*R+n[6]*g+n[10]*M),n[15]=1,n}function Si(n,i,r){return n[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),n[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),n[2]=i[2],n}function Pi(n,i){return n+Math.random()*(i-n)}function Vi(n){return n*Math.PI/180}function Ii(n,i,r){const e=n.createShader(r);return n.shaderSource(e,i),n.compileShader(e),n.getShaderParameter(e,n.COMPILE_STATUS)?e:(alert(n.getShaderInfoLog(e)),null)}function Ti(n){return n instanceof WebGL2RenderingContext}const ln={TextureID:0,NormalTextureID:1,ORMTextureID:2,EmissiveTextureID:3,TeamColorTextureID:4,ReflectionsTextureID:5},W=["TextureID","NormalTextureID","ORMTextureID","EmissiveTextureID","TeamColorTextureID","ReflectionsTextureID"];let cn=class{constructor(i){this.str=i,this.pos=0}char(){return this.pos>=this.str.length&&m(this,"incorrect model data"),this.str[this.pos]}};function m(n,i=""){throw new Error(`SyntaxError, near ${n.pos}`+(i?", "+i:""))}function z(n){if(n.char()==="/"&&n.str[n.pos+1]==="/"){for(n.pos+=2;n.pos<n.str.length&&n.str[++n.pos]!==`
`;);return++n.pos,!0}return!1}const sn=/\s/i;function k(n){for(;n.pos<n.str.length&&sn.test(n.char());)++n.pos}const tn=/[a-z]/i,fn=/[a-z0-9]/i;function h(n){if(!tn.test(n.char()))return null;let i=n.char();for(++n.pos;fn.test(n.char());)i+=n.str[n.pos++];return k(n),i}function d(n,i){n.char()===i&&(++n.pos,k(n))}function t(n,i){n.char()!==i&&m(n,`extected ${i}`),++n.pos,k(n)}function y(n){if(n.char()==='"'){const i=++n.pos;for(;n.char()!=='"';)++n.pos;++n.pos;const r=n.str.substring(i,n.pos-1);return k(n),r}return null}const an=/[-0-9]/,un=/[-+.0-9e]/i;function a(n){if(an.test(n.char())){const i=n.pos;for(++n.pos;un.test(n.char());)++n.pos;const r=parseFloat(n.str.substring(i,n.pos));return k(n),r}return null}function w(n,i,r){if(n.char()!=="{")return null;for(i||(i=[],r=0),t(n,"{");n.char()!=="}";){const e=a(n);e===null&&m(n,"expected number"),i[r++]=e,d(n,",")}return t(n,"}"),i}function hn(n,i,r){if(n.char()!=="{")return 0;const e=r;for(t(n,"{");n.char()!=="}";){const o=a(n);o===null&&m(n,"expected number"),i[r++]=o,d(n,",")}return t(n,"}"),r-e}function U(n,i){if(n.char()!=="{")return i[0]=a(n),i;let r=0;for(t(n,"{");n.char()!=="}";){const e=a(n);e===null&&m(n,"expected number"),i[r++]=e,d(n,",")}return t(n,"}"),i}function D(n){let i=null;const r={};for(n.char()!=="{"&&(i=y(n),i===null&&(i=a(n)),i===null&&m(n,"expected string or number")),t(n,"{");n.char()!=="}";){const e=h(n);if(e||m(n),e==="Interval"){const o=new Uint32Array(2);r[e]=w(n,o,0)}else if(e==="MinimumExtent"||e==="MaximumExtent"){const o=new Float32Array(3);r[e]=w(n,o,0)}else r[e]=w(n)||y(n),r[e]===null&&(r[e]=a(n));d(n,",")}return t(n,"}"),[i,r]}function pn(n,i){const[r,e]=D(n);e.FormatVersion&&(i.Version=e.FormatVersion)}function mn(n,i){const[r,e]=D(n);i.Info=e,i.Info.Name=r}function dn(n,i){a(n),t(n,"{");const r=[];for(;n.char()!=="}";){h(n);const[e,o]=D(n);o.Name=e,o.NonLooping="NonLooping"in o,o.MoveSpeed=o.MoveSpeed||0,o.Rarity=o.Rarity||0,r.push(o)}t(n,"}"),i.Sequences=r}function wn(n,i){const r=[];for(a(n),t(n,"{");n.char()!=="}";){h(n);const[e,o]=D(n);o.Flags=0,"WrapWidth"in o&&(o.Flags+=_.WrapWidth,delete o.WrapWidth),"WrapHeight"in o&&(o.Flags+=_.WrapHeight,delete o.WrapHeight),r.push(o)}t(n,"}"),i.Textures=r}const An={0:1,1:1,2:3,3:4};function yn(n,i,r,e){const o={Frame:i,Vector:null},c=r===0?Int32Array:Float32Array,l=An[r];return o.Vector=U(n,new c(l)),t(n,","),(e===G.Hermite||e===G.Bezier)&&(h(n),o.InTan=U(n,new c(l)),t(n,","),h(n),o.OutTan=U(n,new c(l)),t(n,",")),o}function A(n,i){const r={LineType:G.DontInterp,GlobalSeqId:null,Keys:[]};a(n),t(n,"{");const e=h(n);for((e==="DontInterp"||e==="Linear"||e==="Hermite"||e==="Bezier")&&(r.LineType=G[e]),t(n,",");n.char()!=="}";){const o=h(n);if(o==="GlobalSeqId")r[o]=a(n),t(n,",");else{const c=a(n);c===null&&m(n,"expected frame number or GlobalSeqId"),t(n,":"),r.Keys.push(yn(n,c,i,r.LineType))}}return t(n,"}"),r}function Sn(n,i){const r={Alpha:null,TVertexAnimId:null,Shading:0,CoordId:0};for(t(n,"{");n.char()!=="}";){let e=h(n),o=!1;if(e||m(n),e==="static"&&(o=!0,e=h(n)),!o&&(e==="TextureID"||i.Version>=1100&&e in ln))r[e]=A(n,0);else if(!o&&e==="Alpha")r[e]=A(n,1);else if(e==="Unshaded"||e==="SphereEnvMap"||e==="TwoSided"||e==="Unfogged"||e==="NoDepthTest"||e==="NoDepthSet")r.Shading|=Y[e];else if(e==="FilterMode"){const c=h(n);(c==="None"||c==="Transparent"||c==="Blend"||c==="Additive"||c==="AddAlpha"||c==="Modulate"||c==="Modulate2x")&&(r.FilterMode=Z[c])}else if(e==="TVertexAnimId")r.TVertexAnimId=a(n);else if(i.Version>=900&&e==="EmissiveGain")o?r[e]=a(n):r[e]=A(n,1);else if(i.Version>=1e3&&e==="FresnelColor")if(o){const c=new Float32Array(3);r[e]=w(n,c,0)}else r[e]=A(n,2);else if(i.Version>=1e3&&(e==="FresnelOpacity"||e==="FresnelTeamColor"))o?r[e]=a(n):r[e]=A(n,1);else{let c=a(n);c===null&&(c=h(n)),r[e]=c}d(n,","),z(n),k(n)}return t(n,"}"),r}function Pn(n,i){const r=[];for(a(n),t(n,"{");n.char()!=="}";){const e={RenderMode:0,Layers:[]};for(h(n),t(n,"{");n.char()!=="}";){const o=h(n);if(o||m(n),o==="Layer")e.Layers.push(Sn(n,i));else if(o==="PriorityPlane"||o==="RenderMode")e[o]=a(n);else if(o==="ConstantColor"||o==="SortPrimsFarZ"||o==="FullResolution")e.RenderMode|=Q[o];else if(i.Version>=900&&i.Version<=1100&&o==="Shader")e[o]=y(n);else throw new Error("Unknown material property "+o);d(n,",")}t(n,"}"),r.push(e)}t(n,"}"),i.Materials=r}function H(n,i,r){const e=a(n),o=new(r===1?Float32Array:Uint8Array)(e*i);t(n,"{");for(let c=0;c<e;++c)w(n,o,c*i),t(n,",");return t(n,"}"),o}function Vn(n,i){const r={Vertices:null,Normals:null,TVertices:[],VertexGroup:new Uint8Array(0),Faces:null,Groups:null,TotalGroupsCount:null,MinimumExtent:null,MaximumExtent:null,BoundsRadius:0,Anims:[],MaterialID:null,SelectionGroup:null,Unselectable:!1};for(t(n,"{");n.char()!=="}";){const e=h(n);if(e||m(n),e==="Vertices"||e==="Normals"||e==="TVertices"){let o=3;e==="TVertices"&&(o=2);const c=H(n,o,1);e==="TVertices"?r.TVertices.push(c):r[e]=c}else if(e==="VertexGroup")r[e]=new Uint8Array(r.Vertices.length/3),w(n,r[e],0);else if(e==="Faces"){const o=a(n),c=a(n);let l=0;r.Faces=new Uint16Array(c),t(n,"{"),h(n)!=="Triangles"&&m(n,"unexpected faces type"),t(n,"{");for(let f=0;f<o;++f){const u=hn(n,r.Faces,l);u||m(n,"expected array"),l+=u,d(n,",")}(l!==c||c%3!==0)&&m(n,"mismatched faces array"),t(n,"}"),t(n,"}")}else if(e==="Groups"){const o=[];for(a(n),r.TotalGroupsCount=a(n),t(n,"{");n.char()!=="}";)h(n),o.push(w(n)),d(n,",");t(n,"}"),r.Groups=o}else if(e==="MinimumExtent"||e==="MaximumExtent"){const o=new Float32Array(3);r[e]=w(n,o,0),t(n,",")}else if(e==="BoundsRadius"||e==="MaterialID"||e==="SelectionGroup")r[e]=a(n),t(n,",");else if(e==="Anim"){const[o,c]=D(n);c.Alpha===void 0&&(c.Alpha=1),r.Anims.push(c)}else e==="Unselectable"?(r.Unselectable=!0,t(n,",")):i.Version>=900&&(e==="LevelOfDetail"?(r.LevelOfDetail=a(n),t(n,",")):e==="Name"?(r.Name=y(n),t(n,",")):e==="Tangents"?r.Tangents=H(n,4,1):e==="SkinWeights"&&(r.SkinWeights=H(n,8,0)))}t(n,"}"),i.Geosets.push(r)}function In(n,i){const r={GeosetId:-1,Alpha:1,Color:null,Flags:0};for(t(n,"{");n.char()!=="}";){let e=h(n),o=!1;if(e||m(n),e==="static"&&(o=!0,e=h(n)),e==="Alpha")o?r.Alpha=a(n):r.Alpha=A(n,1);else if(e==="Color")if(o){const c=new Float32Array(3);r.Color=w(n,c,0),r.Color.reverse()}else{r.Color=A(n,2);for(const c of r.Color.Keys)c.Vector.reverse(),c.InTan&&(c.InTan.reverse(),c.OutTan.reverse())}else e==="DropShadow"?r.Flags|=J[e]:r[e]=a(n);d(n,",")}t(n,"}"),i.GeosetAnims.push(r)}function X(n,i,r){const o={Name:y(n),ObjectId:null,Parent:null,PivotPoint:null,Flags:x[i]};for(t(n,"{");n.char()!=="}";){const c=h(n);if(c||m(n),c==="Translation"||c==="Rotation"||c==="Scaling"||c==="Visibility"){let l=2;c==="Rotation"?l=3:c==="Visibility"&&(l=1),o[c]=A(n,l)}else if(c==="BillboardedLockZ"||c==="BillboardedLockY"||c==="BillboardedLockX"||c==="Billboarded"||c==="CameraAnchored")o.Flags|=C[c];else if(c==="DontInherit"){t(n,"{");const l=h(n);l==="Translation"?o.Flags|=C.DontInheritTranslation:l==="Rotation"?o.Flags|=C.DontInheritRotation:l==="Scaling"&&(o.Flags|=C.DontInheritScaling),t(n,"}")}else if(c==="Path")o[c]=y(n);else{let l=h(n)||a(n);(c==="GeosetId"&&l==="Multiple"||c==="GeosetAnimId"&&l==="None")&&(l=null),o[c]=l}d(n,","),z(n),k(n)}return t(n,"}"),r.Nodes[o.ObjectId]=o,o}function Tn(n,i){const r=X(n,"Bone",i);i.Bones.push(r)}function En(n,i){const r=X(n,"Helper",i);i.Helpers.push(r)}function bn(n,i){const r=X(n,"Attachment",i);i.Attachments.push(r)}function gn(n,i){const r=a(n),e=[];t(n,"{");for(let o=0;o<r;++o)e.push(w(n,new Float32Array(3),0)),t(n,",");t(n,"}"),i.PivotPoints=e}function Cn(n,i){const e={Name:y(n),ObjectId:null,Parent:null,PivotPoint:null,EventTrack:null,Flags:x.EventObject};for(t(n,"{");n.char()!=="}";){const o=h(n);if(o||m(n),o==="EventTrack"){const c=a(n);e.EventTrack=w(n,new Uint32Array(c),0)}else if(o==="Translation"||o==="Rotation"||o==="Scaling"){const c=o==="Rotation"?3:2;e[o]=A(n,c)}else e[o]=a(n);d(n,",")}t(n,"}"),i.EventObjects.push(e),i.Nodes[e.ObjectId]=e}function vn(n,i){const e={Name:y(n),ObjectId:null,Parent:null,PivotPoint:null,Shape:L.Box,Vertices:null,Flags:x.CollisionShape};for(t(n,"{");n.char()!=="}";){const o=h(n);if(o||m(n),o==="Sphere")e.Shape=L.Sphere;else if(o==="Box")e.Shape=L.Box;else if(o==="Vertices"){const c=a(n),l=new Float32Array(c*3);t(n,"{");for(let s=0;s<c;++s)w(n,l,s*3),t(n,",");t(n,"}"),e.Vertices=l}else if(o==="Translation"||o==="Rotation"||o==="Scaling"){const c=o==="Rotation"?3:2;e[o]=A(n,c)}else e[o]=a(n);d(n,",")}t(n,"}"),i.CollisionShapes.push(e),i.Nodes[e.ObjectId]=e}function xn(n,i){const r=[],e=a(n);t(n,"{");for(let o=0;o<e;++o)h(n)==="Duration"&&r.push(a(n)),d(n,",");t(n,"}"),i.GlobalSequences=r}function kn(n){let i;for(;n.char()!==void 0&&n.char()!=="{";)++n.pos;for(i=1,++n.pos;n.char()!==void 0&&i>0;)n.char()==="{"?++i:n.char()==="}"&&--i,++n.pos;k(n)}function Rn(n,i){const r={ObjectId:null,Parent:null,Name:null,Flags:0};for(r.Name=y(n),t(n,"{");n.char()!=="}";){let e=h(n),o=!1;if(e||m(n),e==="static"&&(o=!0,e=h(n)),e==="ObjectId"||e==="Parent")r[e]=a(n);else if(e==="EmitterUsesMDL"||e==="EmitterUsesTGA")r.Flags|=nn[e];else if(!o&&(e==="Visibility"||e==="Translation"||e==="Rotation"||e==="Scaling"||e==="EmissionRate"||e==="Gravity"||e==="Longitude"||e==="Latitude")){let c=2;e==="Visibility"||e==="EmissionRate"||e==="Gravity"||e==="Longitude"||e==="Latitude"?c=1:e==="Rotation"&&(c=3),r[e]=A(n,c)}else if(e==="Particle"){for(t(n,"{");n.char()!=="}";){let c=h(n),l=!1;c==="static"&&(l=!0,c=h(n)),!l&&(c==="LifeSpan"||c==="InitVelocity")?r[c]=A(n,1):c==="LifeSpan"||c==="InitVelocity"?r[c]=a(n):c==="Path"&&(r.Path=y(n)),d(n,",")}t(n,"}")}else r[e]=a(n);d(n,",")}t(n,"}"),i.ParticleEmitters.push(r)}function Gn(n,i){const e={Name:y(n),ObjectId:null,Parent:null,PivotPoint:null,Flags:x.ParticleEmitter,FrameFlags:0};for(t(n,"{");n.char()!=="}";){let o=h(n),c=!1;if(o||m(n),o==="static"&&(c=!0,o=h(n)),!c&&(o==="Speed"||o==="Latitude"||o==="Visibility"||o==="EmissionRate"||o==="Width"||o==="Length"||o==="Translation"||o==="Rotation"||o==="Scaling"||o==="Gravity"||o==="Variation")){let l=2;switch(o){case"Rotation":l=3;break;case"Speed":case"Latitude":case"Visibility":case"EmissionRate":case"Width":case"Length":case"Gravity":case"Variation":l=1;break}e[o]=A(n,l)}else if(o==="Variation"||o==="Gravity"||o==="ReplaceableId"||o==="PriorityPlane")e[o]=a(n);else if(o==="SortPrimsFarZ"||o==="Unshaded"||o==="LineEmitter"||o==="Unfogged"||o==="ModelSpace"||o==="XYQuad")e.Flags|=on[o];else if(o==="Both")e.FrameFlags|=F.Head|F.Tail;else if(o==="Head"||o==="Tail")e.FrameFlags|=F[o];else if(o==="Squirt")e[o]=!0;else if(o==="DontInherit"){t(n,"{");const l=h(n);l==="Translation"?e.Flags|=C.DontInheritTranslation:l==="Rotation"?e.Flags|=C.DontInheritRotation:l==="Scaling"&&(e.Flags|=C.DontInheritScaling),t(n,"}")}else if(o==="SegmentColor"){const l=[];for(t(n,"{");n.char()!=="}";){h(n);const s=new Float32Array(3);w(n,s,0);const f=s[0];s[0]=s[2],s[2]=f,l.push(s),d(n,",")}t(n,"}"),e.SegmentColor=l}else o==="Alpha"?(e.Alpha=new Uint8Array(3),w(n,e.Alpha,0)):o==="ParticleScaling"?(e[o]=new Float32Array(3),w(n,e[o],0)):o==="LifeSpanUVAnim"||o==="DecayUVAnim"||o==="TailUVAnim"||o==="TailDecayUVAnim"?(e[o]=new Uint32Array(3),w(n,e[o],0)):o==="Transparent"||o==="Blend"||o==="Additive"||o==="AlphaKey"||o==="Modulate"||o==="Modulate2x"?e.FilterMode=en[o]:e[o]=a(n);d(n,",")}t(n,"}"),i.ParticleEmitters2.push(e),i.Nodes[e.ObjectId]=e}function Ln(n,i){const r={Name:null,Position:null,FieldOfView:0,NearClip:0,FarClip:0,TargetPosition:null};for(r.Name=y(n),t(n,"{");n.char()!=="}";){const e=h(n);if(e||m(n),e==="Position")r.Position=new Float32Array(3),w(n,r.Position,0);else if(e==="FieldOfView"||e==="NearClip"||e==="FarClip")r[e]=a(n);else if(e==="Target"){for(t(n,"{");n.char()!=="}";){const o=h(n);o==="Position"?(r.TargetPosition=new Float32Array(3),w(n,r.TargetPosition,0)):o==="Translation"&&(r.TargetTranslation=A(n,2)),d(n,",")}t(n,"}")}else(e==="Translation"||e==="Rotation")&&(r[e]=A(n,e==="Rotation"?1:2));d(n,",")}t(n,"}"),i.Cameras.push(r)}function Fn(n,i){const e={Name:y(n),ObjectId:null,Parent:null,PivotPoint:null,Flags:x.Light,LightType:0};for(t(n,"{");n.char()!=="}";){let o=h(n),c=!1;if(o||m(n),o==="static"&&(c=!0,o=h(n)),!c&&(o==="Visibility"||o==="Color"||o==="Intensity"||o==="AmbIntensity"||o==="AmbColor"||o==="Translation"||o==="Rotation"||o==="Scaling"||o==="AttenuationStart"||o==="AttenuationEnd")){let l=2;switch(o){case"Rotation":l=3;break;case"Visibility":case"Intensity":case"AmbIntensity":case"AttenuationStart":case"AttenuationEnd":l=1;break}if(e[o]=A(n,l),o==="Color"||o==="AmbColor")for(const s of e[o].Keys)s.Vector.reverse(),s.InTan&&(s.InTan.reverse(),s.OutTan.reverse())}else if(o==="Omnidirectional"||o==="Directional"||o==="Ambient")e.LightType=rn[o];else if(o==="Color"||o==="AmbColor"){const l=new Float32Array(3);w(n,l,0);const s=l[0];l[0]=l[2],l[2]=s,e[o]=l}else e[o]=a(n);d(n,",")}t(n,"}"),i.Lights.push(e),i.Nodes[e.ObjectId]=e}function Kn(n,i){const r=[];for(a(n),t(n,"{");n.char()!=="}";){const e={};for(h(n),t(n,"{");n.char()!=="}";){const o=h(n);if(o||m(n),o==="Translation"||o==="Rotation"||o==="Scaling"){const c=o==="Rotation"?3:2;e[o]=A(n,c)}else throw new Error("Unknown texture anim property "+o);d(n,",")}t(n,"}"),r.push(e)}t(n,"}"),i.TextureAnims=r}function Dn(n,i){const e={Name:y(n),ObjectId:null,Parent:null,PivotPoint:null,Flags:x.RibbonEmitter,HeightAbove:null,HeightBelow:null,Alpha:null,Color:null,LifeSpan:null,TextureSlot:null,EmissionRate:null,Rows:null,Columns:null,MaterialID:0,Gravity:null,Visibility:null};for(t(n,"{");n.char()!=="}";){let o=h(n),c=!1;if(o||m(n),o==="static"&&(c=!0,o=h(n)),!c&&(o==="Visibility"||o==="HeightAbove"||o==="HeightBelow"||o==="Translation"||o==="Rotation"||o==="Scaling"||o==="Alpha"||o==="TextureSlot")){let l=2;switch(o){case"Rotation":l=3;break;case"Visibility":case"HeightAbove":case"HeightBelow":case"Alpha":l=1;break;case"TextureSlot":l=0;break}e[o]=A(n,l)}else if(o==="Color"){const l=new Float32Array(3);w(n,l,0);const s=l[0];l[0]=l[2],l[2]=s,e[o]=l}else e[o]=a(n);d(n,",")}t(n,"}"),i.RibbonEmitters.push(e),i.Nodes[e.ObjectId]=e}function Bn(n,i){i.Version<900&&m(n,"Unexpected model chunk FaceFX");const e={Name:y(n),Path:""};for(t(n,"{");n.char()!=="}";){const o=h(n);o||m(n),o==="Path"&&(e.Path=y(n)),d(n,",")}t(n,"}"),i.FaceFX=i.FaceFX||[],i.FaceFX.push(e)}function Mn(n,i){i.Version<900&&m(n,"Unexpected model chunk BindPose");const r={Matrices:[]};t(n,"{"),h(n);const e=a(n);t(n,"{");for(let o=0;o<e;++o){const c=new Float32Array(12);w(n,c,0),d(n,","),r.Matrices.push(c)}t(n,"}"),t(n,"}"),i.BindPoses=i.BindPoses||[],i.BindPoses.push(r)}function Nn(n,i){i.Version<900&&m(n,"Unexpected model chunk ParticleEmitterPopcorn");const e={Name:y(n),ObjectId:null,Parent:null,PivotPoint:null,Flags:x.ParticleEmitter};for(t(n,"{");n.char()!=="}";){let o=h(n),c=!1;if(o||m(n),o==="static"&&(c=!0,o=h(n)),!c&&(o==="LifeSpan"||o==="EmissionRate"||o==="Speed"||o==="Color"||o==="Alpha"||o==="Visibility"||o==="Rotation"||o==="Scaling"||o==="Translation")){let l=2;switch(o){case"LifeSpan":case"EmissionRate":case"Speed":case"Alpha":case"Visibility":l=1;break}e[o]=A(n,l)}else if(o==="LifeSpan"||o==="EmissionRate"||o==="Speed"||o==="Alpha")e[o]=a(n);else if(o==="Color"){const l=new Float32Array(3);e[o]=w(n,l,0)}else o==="ReplaceableId"?e[o]=a(n):o==="Path"||o==="AnimVisibilityGuide"?e[o]=y(n):o==="Unshaded"||o==="SortPrimsFarZ"||o==="Unfogged"?o==="Unshaded"?e.Flags|=N.Unshaded:o==="Unfogged"?e.Flags|=N.Unfogged:o==="SortPrimsFarZ"&&(e.Flags|=N.SortPrimsFarZ):e[o]=a(n);d(n,",")}t(n,"}"),i.ParticleEmitterPopcorns=i.ParticleEmitterPopcorns||[],i.ParticleEmitterPopcorns.push(e),i.Nodes[e.ObjectId]=e}const q={Version:pn,Model:mn,Sequences:dn,Textures:wn,Materials:Pn,Geoset:Vn,GeosetAnim:In,Bone:Tn,Helper:En,Attachment:bn,PivotPoints:gn,EventObject:Cn,CollisionShape:vn,GlobalSequences:xn,ParticleEmitter:Rn,ParticleEmitter2:Gn,Camera:Ln,Light:Fn,TextureAnims:Kn,RibbonEmitter:Dn,FaceFX:Bn,BindPose:Mn,ParticleEmitterPopcorn:Nn};function bi(n){const i=new cn(n),r={Version:800,Info:{Name:"",MinimumExtent:null,MaximumExtent:null,BoundsRadius:0,BlendTime:150},Sequences:[],GlobalSequences:[],Textures:[],Materials:[],TextureAnims:[],Geosets:[],GeosetAnims:[],Bones:[],Helpers:[],Attachments:[],EventObjects:[],ParticleEmitters:[],ParticleEmitters2:[],Cameras:[],Lights:[],RibbonEmitters:[],CollisionShapes:[],PivotPoints:[],Nodes:[]};for(;i.pos<i.str.length;){for(;z(i););const e=h(i);if(e)e in q?q[e](i,r):kn(i);else break}for(let e=0;e<r.Nodes.length;++e)r.PivotPoints[e]&&(r.Nodes[e].PivotPoint=r.PivotPoints[e]);return r}const j=!0,v=-1,On={0:1,1:1,2:3,3:4};class Un{constructor(i){this.ab=i,this.pos=0,this.length=i.byteLength,this.view=new DataView(this.ab),this.uint=new Uint8Array(this.ab)}keyword(){const i=String.fromCharCode(this.uint[this.pos],this.uint[this.pos+1],this.uint[this.pos+2],this.uint[this.pos+3]);return this.pos+=4,i}expectKeyword(i,r){if(this.keyword()!==i)throw new Error(r)}uint8(){return this.view.getUint8(this.pos++)}uint16(){const i=this.view.getUint16(this.pos,j);return this.pos+=2,i}int32(){const i=this.view.getInt32(this.pos,j);return this.pos+=4,i}float32(){const i=this.view.getFloat32(this.pos,j);return this.pos+=4,i}float32Array(i){const r=new Float32Array(i);for(let e=0;e<i;++e)r[e]=this.float32();return r}uint8Array(i){const r=new Uint8Array(i);for(let e=0;e<i;++e)r[e]=this.uint8();return r}str(i){let r=i;for(;this.uint[this.pos+r-1]===0&&r>0;)--r;const e=String.fromCharCode.apply(String,this.uint.slice(this.pos,this.pos+r));return this.pos+=i,e}animVector(i){const r={Keys:[]},e=i===0,o=On[i],c=this.int32();r.LineType=this.int32(),r.GlobalSeqId=this.int32(),r.GlobalSeqId===v&&(r.GlobalSeqId=null);for(let l=0;l<c;++l){const s={};s.Frame=this.int32(),e?s.Vector=new Int32Array(o):s.Vector=new Float32Array(o);for(let f=0;f<o;++f)e?s.Vector[f]=this.int32():s.Vector[f]=this.float32();if(r.LineType===G.Hermite||r.LineType===G.Bezier)for(const f of["InTan","OutTan"]){s[f]=new Float32Array(o);for(let u=0;u<o;++u)e?s[f][u]=this.int32():s[f][u]=this.float32()}r.Keys.push(s)}return r}}function O(n,i){n.BoundsRadius=i.float32();for(const r of["MinimumExtent","MaximumExtent"]){n[r]=new Float32Array(3);for(let e=0;e<3;++e)n[r][e]=i.float32()}}function Hn(n,i){n.Version=i.int32()}const jn=336;function _n(n,i){n.Info.Name=i.str(jn),i.int32(),O(n.Info,i),n.Info.BlendTime=i.int32()}const zn=80;function Xn(n,i,r){const e=i.pos;for(;i.pos<e+r;){const o=i.str(zn),c={};c.Name=o;const l=new Uint32Array(2);l[0]=i.int32(),l[1]=i.int32(),c.Interval=l,c.MoveSpeed=i.float32(),c.NonLooping=i.int32()>0,c.Rarity=i.float32(),i.int32(),O(c,i),n.Sequences.push(c)}}function Wn(n,i,r){const e=i.pos;for(;i.pos<e+r;){i.int32();const o={Layers:[]};o.PriorityPlane=i.int32(),o.RenderMode=i.int32(),n.Version>=900&&n.Version<1100&&(o.Shader=i.str(80)),i.expectKeyword("LAYS","Incorrect materials format");const c=i.int32();for(let l=0;l<c;++l){const s=i.pos,f=i.int32(),u={};if(u.FilterMode=i.int32(),u.Shading=i.int32(),u.TextureID=i.int32(),u.TVertexAnimId=i.int32(),u.TVertexAnimId===v&&(u.TVertexAnimId=null),u.CoordId=i.int32(),u.Alpha=i.float32(),n.Version>=900&&(u.EmissiveGain=i.float32(),n.Version>=1e3&&(u.FresnelColor=i.float32Array(3),u.FresnelOpacity=i.float32(),u.FresnelTeamColor=i.float32())),n.Version>=1100){u.ShaderTypeId=i.int32();const S=i.int32();for(let I=0;I<S;++I){const T=i.int32();i.int32();const V=I;i.keyword()==="KMTF"?u[W[V]]=i.animVector(0):(u[W[V]]=T,i.pos-=4)}}for(;i.pos<s+f;){const S=i.keyword();if(S==="KMTA")u.Alpha=i.animVector(1);else if(S==="KMTF")u.TextureID=i.animVector(0);else if(S==="KMTE"&&n.Version>=900)u.EmissiveGain=i.animVector(1);else if(S==="KFC3"&&n.Version>=1e3)u.FresnelColor=i.animVector(2);else if(S==="KFCA"&&n.Version>=1e3)u.FresnelOpacity=i.animVector(1);else if(S==="KFTC"&&n.Version>=1e3)u.FresnelTeamColor=i.animVector(1);else throw new Error("Unknown layer chunk data "+S)}o.Layers.push(u)}n.Materials.push(o)}}const qn=256;function $n(n,i,r){const e=i.pos;for(;i.pos<e+r;){const o={};o.ReplaceableId=i.int32(),o.Image=i.str(qn),i.int32(),o.Flags=i.int32(),n.Textures.push(o)}}function Zn(n,i,r){const e=i.pos;for(;i.pos<e+r;){const o={};i.int32(),i.expectKeyword("VRTX","Incorrect geosets format");const c=i.int32();o.Vertices=new Float32Array(c*3);for(let p=0;p<c*3;++p)o.Vertices[p]=i.float32();i.expectKeyword("NRMS","Incorrect geosets format");const l=i.int32();o.Normals=new Float32Array(l*3);for(let p=0;p<l*3;++p)o.Normals[p]=i.float32();i.expectKeyword("PTYP","Incorrect geosets format");const s=i.int32();for(let p=0;p<s;++p)if(i.int32()!==4)throw new Error("Incorrect geosets format");i.expectKeyword("PCNT","Incorrect geosets format");const f=i.int32();for(let p=0;p<f;++p)i.int32();i.expectKeyword("PVTX","Incorrect geosets format");const u=i.int32();o.Faces=new Uint16Array(u);for(let p=0;p<u;++p)o.Faces[p]=i.uint16();i.expectKeyword("GNDX","Incorrect geosets format");const S=i.int32();o.VertexGroup=new Uint8Array(S);for(let p=0;p<S;++p)o.VertexGroup[p]=i.uint8();i.expectKeyword("MTGC","Incorrect geosets format");const I=i.int32();o.Groups=[];for(let p=0;p<I;++p)o.Groups[p]=new Array(i.int32());i.expectKeyword("MATS","Incorrect geosets format"),o.TotalGroupsCount=i.int32();let T=0,V=0;for(let p=0;p<o.TotalGroupsCount;++p)T>=o.Groups[V].length&&(T=0,V++),o.Groups[V][T++]=i.int32();o.MaterialID=i.int32(),o.SelectionGroup=i.int32(),o.Unselectable=i.int32()>0,n.Version>=900&&(o.LevelOfDetail=i.int32(),o.Name=i.str(80)),O(o,i);const K=i.int32();o.Anims=[];for(let p=0;p<K;++p){const b={};O(b,i),o.Anims.push(b)}let E=i.keyword();if(n.Version>=900)for(;;){if(i.pos>=i.length)throw new Error("Unexpected EOF");if(E==="TANG"){if(o.Tangents)throw new Error("Incorrect geoset, multiple Tangents");const p=i.int32();o.Tangents=i.float32Array(p*4)}else if(E==="SKIN"){if(o.SkinWeights)throw new Error("Incorrect geoset, multiple SkinWeights");const p=i.int32();o.SkinWeights=i.uint8Array(p)}else if(E==="UVAS")break;E=i.keyword()}else if(E!=="UVAS")throw new Error("Incorrect geosets format");const B=i.int32();o.TVertices=[];for(let p=0;p<B;++p){i.expectKeyword("UVBS","Incorrect geosets format");const b=i.int32(),R=new Float32Array(b*2);for(let g=0;g<b*2;++g)R[g]=i.float32();o.TVertices.push(R)}n.Geosets.push(o)}}function Yn(n,i,r){const e=i.pos;for(;i.pos<e+r;){const o=i.pos,c=i.int32(),l={};l.Alpha=i.float32(),l.Flags=i.int32(),l.Color=new Float32Array(3);for(let s=0;s<3;++s)l.Color[s]=i.float32();for(l.GeosetId=i.int32(),l.GeosetId===v&&(l.GeosetId=null);i.pos<o+c;){const s=i.keyword();if(s==="KGAO")l.Alpha=i.animVector(1);else if(s==="KGAC")l.Color=i.animVector(2);else throw new Error("Incorrect GeosetAnim chunk data "+s)}n.GeosetAnims.push(l)}}const Qn=80;function P(n,i,r){const e=r.pos,o=r.int32();for(i.Name=r.str(Qn),i.ObjectId=r.int32(),i.ObjectId===v&&(i.ObjectId=null),i.Parent=r.int32(),i.Parent===v&&(i.Parent=null),i.Flags=r.int32();r.pos<e+o;){const c=r.keyword();if(c==="KGTR")i.Translation=r.animVector(2);else if(c==="KGRT")i.Rotation=r.animVector(3);else if(c==="KGSC")i.Scaling=r.animVector(2);else throw new Error("Incorrect node chunk data "+c)}n.Nodes[i.ObjectId]=i}function Jn(n,i,r){const e=i.pos;for(;i.pos<e+r;){const o={};P(n,o,i),o.GeosetId=i.int32(),o.GeosetId===v&&(o.GeosetId=null),o.GeosetAnimId=i.int32(),o.GeosetAnimId===v&&(o.GeosetAnimId=null),n.Bones.push(o)}}function ni(n,i,r){const e=i.pos;for(;i.pos<e+r;){const o={};P(n,o,i),n.Helpers.push(o)}}const ii=256;function oi(n,i,r){const e=i.pos;for(;i.pos<e+r;){const o=i.pos,c=i.int32(),l={};P(n,l,i),l.Path=i.str(ii),i.int32(),l.AttachmentID=i.int32(),i.pos<o+c&&(i.expectKeyword("KATV","Incorrect attachment chunk data"),l.Visibility=i.animVector(1)),n.Attachments.push(l)}}function ei(n,i,r){const e=r/12;for(let o=0;o<e;++o)n.PivotPoints[o]=new Float32Array(3),n.PivotPoints[o][0]=i.float32(),n.PivotPoints[o][1]=i.float32(),n.PivotPoints[o][2]=i.float32()}function ri(n,i,r){const e=i.pos;for(;i.pos<e+r;){const o={};P(n,o,i),i.expectKeyword("KEVT","Incorrect EventObject chunk data");const c=i.int32();o.EventTrack=new Uint32Array(c),i.int32();for(let l=0;l<c;++l)o.EventTrack[l]=i.int32();n.EventObjects.push(o)}}function li(n,i,r){const e=i.pos;for(;i.pos<e+r;){const o={};P(n,o,i),o.Shape=i.int32(),o.Shape===L.Box?o.Vertices=new Float32Array(6):o.Vertices=new Float32Array(3);for(let c=0;c<o.Vertices.length;++c)o.Vertices[c]=i.float32();o.Shape===L.Sphere&&(o.BoundsRadius=i.float32()),n.CollisionShapes.push(o)}}function ci(n,i,r){const e=i.pos;for(n.GlobalSequences=[];i.pos<e+r;)n.GlobalSequences.push(i.int32())}const si=256;function ti(n,i,r){const e=i.pos;for(;i.pos<e+r;){const o=i.pos,c=i.int32(),l={};for(P(n,l,i),l.EmissionRate=i.float32(),l.Gravity=i.float32(),l.Longitude=i.float32(),l.Latitude=i.float32(),l.Path=i.str(si),i.int32(),l.LifeSpan=i.float32(),l.InitVelocity=i.float32();i.pos<o+c;){const s=i.keyword();if(s==="KPEV")l.Visibility=i.animVector(1);else if(s==="KPEE")l.EmissionRate=i.animVector(1);else if(s==="KPEG")l.Gravity=i.animVector(1);else if(s==="KPLN")l.Longitude=i.animVector(1);else if(s==="KPLT")l.Latitude=i.animVector(1);else if(s==="KPEL")l.LifeSpan=i.animVector(1);else if(s==="KPES")l.InitVelocity=i.animVector(1);else throw new Error("Incorrect particle emitter chunk data "+s)}n.ParticleEmitters.push(l)}}function fi(n,i,r){const e=i.pos;for(;i.pos<e+r;){const o=i.pos,c=i.int32(),l={};P(n,l,i),l.Speed=i.float32(),l.Variation=i.float32(),l.Latitude=i.float32(),l.Gravity=i.float32(),l.LifeSpan=i.float32(),l.EmissionRate=i.float32(),l.Width=i.float32(),l.Length=i.float32(),l.FilterMode=i.int32(),l.Rows=i.int32(),l.Columns=i.int32();const s=i.int32();l.FrameFlags=0,(s===0||s===2)&&(l.FrameFlags|=F.Head),(s===1||s===2)&&(l.FrameFlags|=F.Tail),l.TailLength=i.float32(),l.Time=i.float32(),l.SegmentColor=[];for(let f=0;f<3;++f){l.SegmentColor[f]=new Float32Array(3);for(let u=0;u<3;++u)l.SegmentColor[f][u]=i.float32()}l.Alpha=new Uint8Array(3);for(let f=0;f<3;++f)l.Alpha[f]=i.uint8();l.ParticleScaling=new Float32Array(3);for(let f=0;f<3;++f)l.ParticleScaling[f]=i.float32();for(const f of["LifeSpanUVAnim","DecayUVAnim","TailUVAnim","TailDecayUVAnim"]){l[f]=new Uint32Array(3);for(let u=0;u<3;++u)l[f][u]=i.int32()}for(l.TextureID=i.int32(),l.TextureID===v&&(l.TextureID=null),l.Squirt=i.int32()>0,l.PriorityPlane=i.int32(),l.ReplaceableId=i.int32();i.pos<o+c;){const f=i.keyword();if(f==="KP2V")l.Visibility=i.animVector(1);else if(f==="KP2E")l.EmissionRate=i.animVector(1);else if(f==="KP2W")l.Width=i.animVector(1);else if(f==="KP2N")l.Length=i.animVector(1);else if(f==="KP2S")l.Speed=i.animVector(1);else if(f==="KP2L")l.Latitude=i.animVector(1);else if(f==="KP2G")l.Gravity=i.animVector(1);else if(f==="KP2R")l.Variation=i.animVector(1);else throw new Error("Incorrect particle emitter2 chunk data "+f)}n.ParticleEmitters2.push(l)}}const ai=80;function ui(n,i,r){const e=i.pos;for(;i.pos<e+r;){const o=i.pos,c=i.int32(),l={};for(l.Name=i.str(ai),l.Position=new Float32Array(3),l.Position[0]=i.float32(),l.Position[1]=i.float32(),l.Position[2]=i.float32(),l.FieldOfView=i.float32(),l.FarClip=i.float32(),l.NearClip=i.float32(),l.TargetPosition=new Float32Array(3),l.TargetPosition[0]=i.float32(),l.TargetPosition[1]=i.float32(),l.TargetPosition[2]=i.float32();i.pos<o+c;){const s=i.keyword();if(s==="KCTR")l.Translation=i.animVector(2);else if(s==="KTTR")l.TargetTranslation=i.animVector(2);else if(s==="KCRL")l.Rotation=i.animVector(1);else throw new Error("Incorrect camera chunk data "+s)}n.Cameras.push(l)}}function hi(n,i,r){const e=i.pos;for(;i.pos<e+r;){const o=i.pos,c=i.int32(),l={};P(n,l,i),l.LightType=i.int32(),l.AttenuationStart=i.float32(),l.AttenuationEnd=i.float32(),l.Color=new Float32Array(3);for(let s=0;s<3;++s)l.Color[s]=i.float32();l.Intensity=i.float32(),l.AmbColor=new Float32Array(3);for(let s=0;s<3;++s)l.AmbColor[s]=i.float32();for(l.AmbIntensity=i.float32();i.pos<o+c;){const s=i.keyword();if(s==="KLAV")l.Visibility=i.animVector(1);else if(s==="KLAC")l.Color=i.animVector(2);else if(s==="KLAI")l.Intensity=i.animVector(1);else if(s==="KLBC")l.AmbColor=i.animVector(2);else if(s==="KLBI")l.AmbIntensity=i.animVector(1);else if(s==="KLAS")l.AttenuationStart=i.animVector(0);else if(s==="KLAE")l.AttenuationEnd=i.animVector(0);else throw new Error("Incorrect light chunk data "+s)}n.Lights.push(l)}}function pi(n,i,r){const e=i.pos;for(;i.pos<e+r;){const o=i.pos,c=i.int32(),l={};for(;i.pos<o+c;){const s=i.keyword();if(s==="KTAT")l.Translation=i.animVector(2);else if(s==="KTAR")l.Rotation=i.animVector(3);else if(s==="KTAS")l.Scaling=i.animVector(2);else throw new Error("Incorrect light chunk data "+s)}n.TextureAnims.push(l)}}function mi(n,i,r){const e=i.pos;for(;i.pos<e+r;){const o=i.pos,c=i.int32(),l={};P(n,l,i),l.HeightAbove=i.float32(),l.HeightBelow=i.float32(),l.Alpha=i.float32(),l.Color=new Float32Array(3);for(let s=0;s<3;++s)l.Color[s]=i.float32();for(l.LifeSpan=i.float32(),l.TextureSlot=i.int32(),l.EmissionRate=i.int32(),l.Rows=i.int32(),l.Columns=i.int32(),l.MaterialID=i.int32(),l.Gravity=i.float32();i.pos<o+c;){const s=i.keyword();if(s==="KRVS")l.Visibility=i.animVector(1);else if(s==="KRHA")l.HeightAbove=i.animVector(1);else if(s==="KRHB")l.HeightBelow=i.animVector(1);else if(s==="KRAL")l.Alpha=i.animVector(1);else if(s==="KRTX")l.TextureSlot=i.animVector(0);else throw new Error("Incorrect ribbon emitter chunk data "+s)}n.RibbonEmitters.push(l)}}function di(n,i,r){if(n.Version<900)throw new Error("Mismatched version chunk");const e=i.pos;for(n.FaceFX=n.FaceFX||[];i.pos<e+r;){const o={Name:"",Path:""};o.Name=i.str(80),o.Path=i.str(260),n.FaceFX.push(o)}}function wi(n,i,r){if(n.Version<900)throw new Error("Mismatched version chunk");const e=i.pos;n.BindPoses=n.BindPoses||[];const o=i.int32(),c={Matrices:[]};for(let l=0;l<o;++l){const s=i.float32Array(12);c.Matrices.push(s)}if(n.BindPoses.push(c),i.pos!==e+r)throw new Error("Mismatched BindPose data")}function Ai(n,i,r){if(n.Version<900)throw new Error("Mismatched version chunk");const e=i.pos;for(n.ParticleEmitterPopcorns=n.ParticleEmitterPopcorns||[];i.pos<e+r;){const o=i.pos,c=i.int32(),l={};for(P(n,l,i),l.LifeSpan=i.float32(),l.EmissionRate=i.float32(),l.Speed=i.float32(),l.Color=i.float32Array(3),l.Alpha=i.float32(),l.ReplaceableId=i.int32(),l.Path=i.str(260),l.AnimVisibilityGuide=i.str(260);i.pos<o+c;){const s=i.keyword();if(s==="KPPA")l.Alpha=i.animVector(1);else if(s==="KPPC")l.Color=i.animVector(2);else if(s==="KPPE")l.EmissionRate=i.animVector(1);else if(s==="KPPL")l.LifeSpan=i.animVector(1);else if(s==="KPPS")l.Speed=i.animVector(1);else if(s==="KPPV")l.Visibility=i.animVector(1);else throw new Error("Incorrect particle emitter popcorn chunk data "+s)}n.ParticleEmitterPopcorns.push(l)}}const $={VERS:Hn,MODL:_n,SEQS:Xn,MTLS:Wn,TEXS:$n,GEOS:Zn,GEOA:Yn,BONE:Jn,HELP:ni,ATCH:oi,PIVT:ei,EVTS:ri,CLID:li,GLBS:ci,PREM:ti,PRE2:fi,CAMS:ui,LITE:hi,TXAN:pi,RIBB:mi,FAFX:di,BPOS:wi,CORN:Ai};function gi(n){const i=new Un(n);if(i.keyword()!=="MDLX")throw new Error("Not a mdx model");const r={Version:800,Info:{Name:"",MinimumExtent:null,MaximumExtent:null,BoundsRadius:0,BlendTime:150},Sequences:[],GlobalSequences:[],Textures:[],Materials:[],TextureAnims:[],Geosets:[],GeosetAnims:[],Bones:[],Helpers:[],Attachments:[],EventObjects:[],ParticleEmitters:[],ParticleEmitters2:[],Cameras:[],Lights:[],RibbonEmitters:[],CollisionShapes:[],PivotPoints:[],Nodes:[]};for(;i.pos<i.length;){const e=i.keyword(),o=i.int32();e in $?$[e](r,i,o):i.pos+=o}for(let e=0;e<r.Nodes.length;++e)r.Nodes[e]&&r.PivotPoints[e]&&(r.Nodes[e].PivotPoint=r.PivotPoints[e]);return r.Info.NumGeosets=r.Geosets.length,r.Info.NumGeosetAnims=r.GeosetAnims.length,r.Info.NumBones=r.Bones.length,r.Info.NumLights=r.Lights.length,r.Info.NumAttachments=r.Attachments.length,r.Info.NumEvents=r.EventObjects.length,r.Info.NumParticleEmitters=r.ParticleEmitters.length,r.Info.NumParticleEmitters2=r.ParticleEmitters2.length,r.Info.NumRibbonEmitters=r.RibbonEmitters.length,r}Float32Array.prototype.reverse||(Float32Array.prototype.reverse=Array.prototype.reverse);export{L as C,Z as F,J as G,W as L,Q as M,C as N,nn as P,_ as T,bi as a,on as b,N as c,Y as d,rn as e,en as f,F as g,G as h,Ii as i,Vi as j,Ti as k,yi as m,gi as p,Pi as r,Si as v};
